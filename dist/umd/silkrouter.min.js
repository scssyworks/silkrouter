!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";const s=/:[^/]+/g,o=/^\/(?=[^?]*)/,n="vpushstate",r="?",i="",a=void 0,c=typeof i,h=typeof a,u="State",l=`push${u}`,p=`replace${u}`;function f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var b=f((function(t){return"object"==typeof t&&null!==t}));function d(t,e,s){t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s||[]}))}function y(t){return typeof t===c?t.trim():i}function g(t,e){e=b(e)?e:{};const[s,c]=t.split(r),{replace:h=!1,preventDefault:u=!1,queryString:f=c,data:g,pageTitle:x=null}=e,{preservePath:m,hashRouting:v,history:w,context:R}=this.config;if(!function(t){return o.test(t)}(t=y(s)))throw new TypeError("Route format is incorrect!");{const e=t;v&&(t=`${m?"":"/"}#${t}`),t=`${t}${y(f?`${r+f}`:i)}`;const s=w.state||{idx:0};w[h?p:l]({data:g,idx:s.idx+1},x,t),!u&&e&&d(R,n,[{path:e,hash:v},a,this])}}const x=(t,e)=>y(t?e.hash.substring(1).split(r)[0]:e.pathname);class m{constructor(t,e){const[s,o,n]=t,{location:i,history:a}=n.config;this.route=s.path,this.isHashRoute=s.hash,this.router=n,this.currentEvent=o||e,this.query={path:y(i.search.substring(1)),hash:y(i.hash.split(r)[1])};const{state:c}=o||{},{data:h,idx:u=0}=c||a.state||{};this.data=h,this.index=+u}}function v(){return t=>new e.Observable((e=>{const s=t.subscribe({next:t=>{const[,,s]=t.detail;s===this&&e.next(new m(t.detail,t))},error:e.error,complete:e.complete});return()=>{s.unsubscribe()}}))}function w(t){const{hashRouting:s,location:o,init:n}=this.config,r=x(s,o);return o=>new e.Observable((e=>{const i=o.subscribe(e);return t||(t=!0,n&&r&&e.next(new m([{path:r,hash:s},a,this]))),()=>{i.unsubscribe()}}))}class R{static get global(){return typeof globalThis!==h?globalThis:global||self}constructor(t){let{history:s,context:o,location:r,hash:i}=t;if(!s[l])throw new Error("History is not supported in this environment!");this.popStateSubscription=e.fromEvent(R.global,"popstate").subscribe((t=>{const e=x(i,r);e&&d(o,n,[{path:e,hash:i},t,this])})),this.listeners=e.fromEvent(o,n).pipe(v.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.listeners.pipe(w.apply(this),...e)}subscribe(t){return this.pipe().subscribe(t)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe()}}t.Router=class extends R{constructor(t){t=b(t)?t:{};const{history:e,location:s,document:o}=R.global,n=o.body;super({history:e,location:s,context:n,hash:t.hashRouting}),this.config=Object.freeze({init:!0,hashRouting:!1,preservePath:!1,context:n,history:e,location:s,...t}),t.hashRouting&&!s.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){g.apply(this,[t,e])}},t.RouterCore=R,t.resolveParams=function(t,e){const o={};if(s.test(t)){const n=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,n.test(e)){const r=Array.from(t.match(s)).map((t=>t.replace(":",i))),a=Array.from(e.match(n));a.shift(),r.forEach(((t,e)=>{o[t]=a[e]}))}}return o},Object.defineProperty(t,"__esModule",{value:!0})}));
