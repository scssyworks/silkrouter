!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";const o=/^\/(?=[^?]*)/,n="Route string is not a pure route",s="vpushstate",i="?",r="",u=void 0,c=typeof r,a="boolean",h=typeof u,p="State",l=`push${p}`,f=`replace${p}`;function b(){return typeof globalThis!==h?globalThis:global||self}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}var d=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},g=function(t){return"object"==typeof t&&null!==t},m=y(void 0);y(""),("undefined"==typeof window?"undefined":y(window))!==m&&window.location;const v=Object.keys;function x(t){return typeof t===c?t.trim():r}function w(t,e,o){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===c&&function(t,e){if(g(t)){const o=v(t);for(let n=0;n<o.length;n++){const s=o[n],i=e(t[s],d(s)?+s:s);if(typeof i===a&&!i)break}}}(t,(t=>{const n=new(b().CustomEvent)(e,{bubbles:!0,cancelable:!0,detail:o||[]});t.dispatchEvent(n)}))}function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[c,a]=t.split(i),{replace:h=!1,preventDefault:p=!1,queryString:b=a,data:y,pageTitle:d=null}=e,{preservePath:g,hashRouting:m,history:v,context:S}=this.config;if(!function(t){return o.test(t)}(t=x(c)))throw new TypeError(n);{const e=t;m&&(t=`${g?"":"/"}#${t}`),t=`${t}${x(b?`${i+b}`:r)}`;const o=v.state||{idx:0};v[h?f:l]({data:y,idx:o.idx+1},d,t),!p&&e&&w(S,s,[{path:e,hash:m},u,this])}}const _=(t,e)=>x(t?e.hash.substring(1).split(i)[0]:e.pathname);class j{constructor(t,e){const[o,n,s]=t,{location:r,history:u}=s.config;this.route=o.path,this.isHashRoute=o.hash,this.router=s,this.currentEvent=n||e,this.query={path:x(r.search.substring(1)),hash:x(r.hash.split(i)[1])};const{state:c}=n||{},{data:a,idx:h=0}=c||u.state||{};this.data=a,this.index=h}}function R(){return t=>new e.Observable((e=>{const o=t.subscribe({next:t=>{t.detail[2]===this&&e.next(new j(t.detail,t))},error:e.error,complete:e.complete});return()=>{o.unsubscribe()}}))}function E(t){const{hashRouting:o,location:n,init:s}=this.config,i=_(o,n);return n=>new e.Observable((e=>{const r=n.subscribe(e);return t||(t=!0,s&&i&&e.next(new j([{path:i,hash:o},u,this]))),()=>{r.unsubscribe()}}))}class ${constructor(t){let{global:o,history:n,context:i,location:r,hash:u}=t;if(!n[l])throw new Error("History unsupported!");this.__paths__=[],this.popStateSubscription=e.fromEvent(o,"popstate").subscribe((t=>{const e=_(u,r);e&&w(i,s,[{path:e,hash:u},t,this])})),this.listeners=e.fromEvent(i,s).pipe(R.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];return this.listeners.pipe(E.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}t.Router=class extends ${constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=b(),{history:o,location:n,document:s}=e,i=s.body;super({global:e,history:o,location:n,context:i,hash:t.hashRouting}),this.config=Object.freeze(function(){return Object.assign(...arguments)}({init:!0,hashRouting:!1,preservePath:!1},t,{context:i,history:o,location:n})),t.hashRouting&&!n.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){S.apply(this,[t,e])}},t.RouterCore=$,Object.defineProperty(t,"__esModule",{value:!0})}));
