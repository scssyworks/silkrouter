!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(){return Object.assign(...arguments)}const r="popstate",o=/:[^/]+/g,s=/^\/(?=[^?]*)/,i="Route string is not a pure route",c="vpushstate",a=["route","hashRouting","path","hash","search","hashSearch","data"],u="&",h="?",f="",p=void 0,l=typeof f,b="boolean",y=typeof p,d="function",g="State",m=`push${g}`,v=`replace${g}`;function _(){return typeof globalThis!==y?globalThis:global||self}function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}var w=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},O=function(t){return"object"==typeof t&&null!==t},S=void 0,j=x(S),E=x(""),R=("undefined"==typeof window?"undefined":x(window))!==j?window.location:null,$=Array.isArray;function A(t){return-1===["__proto__","prototype"].indexOf(t)}function N(t){return/\[/.test(t)}function T(){return Object.create(null)}function k(t,e){var n=this;x(t)!==E&&(t=R?R.search:""),t=t.substring("?"===t.charAt(0));var r=T();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));N(o[0])?P.apply(n,[].concat(o).concat([r,e])):F.apply(n,[o,r,!1,e])})),r}function C(t,e){return x(t)===j?e?[]:T():e?t:(n=t,r=T(),$(n)&&n.forEach((function(t,e){r[e]=t})),r);var n,r}function I(t,e){return O(t)&&!$(t)?{ob:t}:$(t)||x(t)===j?{ob:C(t,w(e))}:{ob:[t],push:null!==t}}function P(t,e,n,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var s=o[1],i=o[2];if(N(t=t.replace(/\[([^\[]*)\]/,"")))""===i&&(i="0"),P(t=t.replace(/[^\[]+/,i),e,n[s]=I(n[s],i).ob,r);else if(i){if(A(s)&&A(i)){var c=I(n[s],i),a=c.ob,u=c.push;n[s]=a;var h=u?T():n[s];h[i]=M(e,!r),u&&n[s].push(h)}}else F([o[1],e],n,!0,r)}}function F(t,e,n,r){var o=t[0],s=t[1];A(o)&&(s=M(s,!r),!function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(e,o)?e[o]=n?[s]:s:(e[o]=$(e[o])?e[o]:[e[o]],e[o].push(s)))}function M(t,e){if(null==t)return"";if(e||x(t)!==E)return t;if(t=t.trim(),w(t))return+t;switch(t){case"null":return null;case j:return S;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}const q=Array.isArray,z=Object.keys;function L(t){return typeof t===l?t.trim():f}function U(t){return s.test(t)}function H(t,e){if(O(t)){const n=z(t);for(let r=0;r<n.length;r++){const o=n[r],s=e(t[o],w(o)?+o:o);if(typeof s===b&&!s)break}}}function Q(t,e,n){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===l&&H(t,(t=>{const r=new(_().CustomEvent)(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(r)}))}class B{constructor(t,e){const n=t[0],r=t[1],o=t[2],{location:s,history:i}=o.config;this.route=n.path,this.hashRouting=n.hash,this.routerInstance=o,this.virtualEvent=e||{},this.originalEvent=r||{},this.path=L(s.pathname),this.hash=s.hash,this.search=L(s.search.substring(1)),this.hashSearch=L(s.hash&&s.hash.split(h)[1]);const{state:c}=this.originalEvent;this.data=c&&c.data||i.state&&i.state.data}}function D(){return t=>new e.Observable((e=>{const n=t.subscribe({next:t=>{t.detail[2]===this&&e.next(new B(t.detail,t))},error:e.error,complete:e.complete});return()=>{n.unsubscribe()}}))}const G=(t,e)=>L(t?e.hash.substring(1).split(h)[0]:e.pathname);function J(t){const{context:n,location:o,hashRouting:s}=t.config;t.popStateSubscription=e.fromEvent(_(),r).subscribe((e=>{const r=G(s,o);r&&Q(n,c,[{path:r,hash:s},e,t])})),t.listeners=e.fromEvent(n,c).pipe(D.apply(t)),s&&!o.hash&&t.set("/",!0,!1)}const K=encodeURIComponent;function V(t,e,n){O(n)?H(n,((r,o)=>{V(t,`${e}[${q(n)?f:o}]`,r)})):typeof n!==d&&t.push(`${K(e)}=${K(n)}`)}function W(t){let e=[];return O(t)?(H(t,((t,n)=>{V(e,n,t)})),e.join(u)):typeof t===l?t:f}function X(t,e){const{location:r}=this.config,o=L(r.search&&r.search.substring(1)),s=L(e?r.hash.split(h)[1]:o);return s?W(n(k(o),k(s),k(t))):t}function Y(t,e,r){let o=!0;typeof r===b&&(o=r);const{preservePath:s,hashRouting:a,history:u}=this.config,y=n({replace:e,exec:o},typeof t===l?{route:t}:t);e=y.replace,o=y.exec;let{route:d,queryString:g}=y;const{preserveQuery:_,data:x,pageTitle:w=null}=y,S=d.split(h);if(O(g)&&(g=W(g)),g=L(g||S[1]),d=L(S[0]),_&&(g=X.apply(this,[g,a])),!U(d))throw new TypeError(i);{const t=d;a&&(d=`/#${d}`,s&&(d=`${d.substring(1)}`)),d=`${d}${g?`${h+g}`:f}`,u[e?v:m]({data:x},w,d),o&&t&&Q(this.config.context,c,[{path:t,hash:a},p,this])}return this}function Z(t){const{hashRouting:n,location:r,init:o}=this.config,s=G(n,r);return r=>new e.Observable((e=>{const i=r.subscribe(e);return t||(t=!0,o&&s&&e.next(new B([{path:s,hash:n},p,this]))),()=>{i.unsubscribe()}}))}class tt{constructor(t){const{history:e,location:r,document:o}=_();if(!e[m])throw new Error("History unsupported!");this.config=Object.freeze(n({init:!0,hashRouting:!1,preservePath:!1,context:o.body,location:r,history:e},t||{})),this.__paths__=[],J(this)}pipe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.listeners.pipe(Z.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}set(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Y.apply(this,e)}destroy(t){typeof t===d&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}function et(t,e){const n={};if(o.test(t)){const r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,r.test(e)){const s=Array.from(t.match(o)).map((t=>t.replace(":",f))),i=Array.from(e.match(r));i.shift(),H(s,((t,e)=>{n[t]=i[e]}))}}return n}function nt(t,e,n){H(z(t),(r=>{O(t[r])&&O(e[r])?nt(t[r],e[r],n):n.break=t[r]!==e[r]}))}var rt=Object.freeze({__proto__:null,route:function(t,n,r){if(typeof n===b&&(r=n,n=p),t=L(t),n instanceof tt){const e=n.__paths__;-1===e.indexOf(t)&&e.push(t)}return o=>new e.Observable((e=>{const s=o.subscribe({next(n){let o=n.route;if(U(t)){r&&(t=t.toLowerCase(),o=o.toLowerCase());const s=et(t,o),i=z(s).length;(o===t||i>0)&&(i>0&&(n.params=s),e.next(n))}else e.error(new Error(i))},error:e.error,complete:e.complete});return()=>{if(n instanceof tt){const e=n.__paths__,r=e.indexOf(t);r>-1&&e.splice(r,1)}s.unsubscribe()}}))},deparam:function(t){return n=>new e.Observable((e=>{const r=n.subscribe({next(n){try{n.search=k(n.search,t),n.hashSearch=k(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:e.error,complete:e.complete});return()=>{r.unsubscribe()}}))},noMatch:function(t){return n=>new e.Observable((e=>{const r=n.subscribe({next(n){if(t instanceof tt){const r=t.__paths__;if(r.length>0){const t=n.route;let o=!1;H(r,(e=>{if(e===t||z(et(e,t)).length)return!(o=!0)})),o||(n.noMatch=!0,e.next(n))}}},error:e.error,complete:e.complete});return()=>{r.unsubscribe()}}))},cache:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,r=arguments.length>1?arguments[1]:void 0,o={};return typeof t===b&&(r=t,t=a),s=>new e.Observable((e=>{const i=s.subscribe({next(s){H(t,(t=>{if(r&&O(s[t])&&O(o[t])){const r={};if(nt(s[t],o[t],r),r.break)return n(o,s),e.next(s),!1}else if(s[t]!==o[t])return n(o,s),e.next(s),!1}))},error:e.error,complete:e.complete});return()=>{i.unsubscribe(),o={}}}))}});t.Router=tt,t.operators=rt,Object.defineProperty(t,"__esModule",{value:!0})}));
