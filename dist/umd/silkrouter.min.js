!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,n){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(){return Object.assign.apply(Object,arguments)}var u=/:[^/]+/g,c=/^\/(?=[^?]*)/,s="Route string is not a pure route",f="vpushstate",h=["route","hashRouting","path","hash","search","hashSearch","data"],l="?",p="",b=void 0,v=e(p),y=e(!0),d=e(b);e({}),e(0);var m=e((function(){})),g="State",w="push".concat(g),_="replace".concat(g);function x(){return("undefined"==typeof globalThis?"undefined":e(globalThis))!==d?globalThis:global||self}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}var S=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},j=function(t){return"object"==typeof t&&null!==t},E=void 0,R=O(E),k=O(""),A=("undefined"==typeof window?"undefined":O(window))!==R?window.location:null,T=Array.isArray;function N(t){return-1===["__proto__","prototype"].indexOf(t)}function C(t){return/\[/.test(t)}function P(){return Object.create(null)}function I(t,n){var e=this;O(t)!==k&&(t=A?A.search:""),t=t.substring("?"===t.charAt(0));var r=P();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));C(o[0])?q.apply(e,[].concat(o).concat([r,n])):z.apply(e,[o,r,!1,n])})),r}function F(t,n){return O(t)===R?n?[]:P():n?t:(e=t,r=P(),T(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function M(t,n){return j(t)&&!T(t)?{ob:t}:T(t)||O(t)===R?{ob:F(t,S(n))}:{ob:[t],push:null!==t}}function q(t,n,e,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var i=o[1],a=o[2];if(C(t=t.replace(/\[([^\[]*)\]/,"")))""===a&&(a="0"),q(t=t.replace(/[^\[]+/,a),n,e[i]=M(e[i],a).ob,r);else if(a){if(N(i)&&N(a)){var u=M(e[i],a),c=u.ob,s=u.push;e[i]=c;var f=s?P():e[i];f[a]=L(n,!r),s&&e[i].push(f)}}else z([o[1],n],e,!0,r)}}function z(t,n,e,r){var o=t[0],i=t[1];N(o)&&(i=L(i,!r),!function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(n,o)?n[o]=e?[i]:i:(n[o]=T(n[o])?n[o]:[n[o]],n[o].push(i)))}function L(t,n){if(null==t)return"";if(n||O(t)!==k)return t;if(t=t.trim(),S(t))return+t;switch(t){case"null":return null;case R:return E;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}var U=Array.isArray,H=Object.keys;function Q(t){return e(t)===v?t.trim():p}function B(t){return c.test(t)}function D(t,n){if(j(t))for(var r=H(t),o=0;o<r.length;o++){var i=r[o],a=n(t[i],S(i)?+i:i);if(e(a)===y){if(a)continue;break}}}function G(t,n,r){(t=Array.from(t instanceof Node?[t]:t)).length&&e(n)===v&&D(t,(function(t){var e=(new x).CustomEvent(n,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(e)}))}var J=i((function t(n,e){r(this,t);var o=n[0],i=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=Q(c.pathname),this.hash=c.hash,this.search=Q(c.search.substring(1)),this.hashSearch=Q(c.hash&&c.hash.split(l)[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data}));function K(){var t=this;return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){e.detail[2]===t&&n.next(new J(e.detail,e))},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}}var V=function(t,n){return Q(t?n.hash.substring(1).split(l)[0]:n.pathname)};function W(t){var e=t.config,r=e.context,o=e.location,i=e.hashRouting;t.popStateSubscription=n.fromEvent(x(),"popstate").subscribe((function(n){var e=V(i,o);e&&G(r,f,[{path:e,hash:i},n,t])})),t.listeners=n.fromEvent(r,f).pipe(K.apply(t)),i&&!o.hash&&t.set("/",!0,!1)}var X=encodeURIComponent;function Y(t,n,r){j(r)?D(r,(function(e,o){Y(t,"".concat(n,"[").concat(U(r)?p:o,"]"),e)})):e(r)!==m&&t.push("".concat(X(n),"=").concat(X(r)))}function Z(t){var n=[];return j(t)?(D(t,(function(t,e){Y(n,e,t)})),n.join("&")):e(t)===v?t:p}function $(t,n){var e=this.config.location,r=Q(e.search&&e.search.substring(1)),o=Q(n?e.hash.split(l)[1]:r);return o?Z(a(I(r),I(o),I(t))):t}function tt(t,n,r){r=r||!0;var o=this.config,i=o.preservePath,u=o.hashRouting,c=o.history,h=a({replace:n,exec:r},e(t)===v?{route:t}:t);n=h.replace,r=h.exec;var y=h.route,d=h.queryString,m=h.preserveQuery,g=h.data,x=h.pageTitle,O=void 0===x?null:x,S=y.split(l);if(j(d)&&(d=Z(d)),d=Q(d||S[1]),y=Q(S[0]),m&&(d=$.apply(this,[d,u])),!B(y))throw new TypeError(s);var E=y;return u&&(y="/#".concat(y),i&&(y="".concat(y.substring(1)))),y="".concat(y).concat(d?"".concat(l+d):p),c[n?_:w]({data:g},O,y),r&&E&&G(this.config.context,f,[{path:E,hash:u},b,this]),this}function nt(t){var e=this,r=this.config,o=r.hashRouting,i=r.location,a=r.init,u=V(o,i);return function(r){return new n.Observable((function(n){var i=r.subscribe(n);return t||(t=!0,a&&u&&n.next(new J([{path:u,hash:o},b,e]))),function(){i.unsubscribe()}}))}}var et=function(){function t(n){r(this,t);var e=x(),o=e.history,i=e.location,u=e.document;if(!o[w])throw new Error("History unsupported!");this.config=Object.freeze(a({init:!0,hashRouting:!1,preservePath:!1,context:u.body,location:i,history:o},n||{})),this.__paths__=[],W(this)}return i(t,[{key:"pipe",value:function(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[nt.apply(this)].concat(e))}},{key:"subscribe",value:function(){var t;return(t=this.pipe()).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return tt.apply(this,n)}},{key:"destroy",value:function(t){e(t)===m&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function rt(t,n){var e={};if(u.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(u.lastIndex=0,r.test(n)){var o=Array.from(t.match(u)).map((function(t){return t.replace(":",p)})),i=Array.from(n.match(r));i.shift(),D(o,(function(t,n){e[t]=i[n]}))}}return e}function ot(t,n,e){D(H(t),(function(r){j(t[r])&&j(n[r])?ot(t[r],n[r],e):e.break=t[r]!==n[r]}))}var it=Object.freeze({__proto__:null,route:function(t,r,o){if(e(r)===y&&(o=r,r=b),t=Q(t),r instanceof et){var i=r.__paths__;-1===i.indexOf(t)&&i.push(t)}return function(e){return new n.Observable((function(n){var i=e.subscribe({next:function(e){var r=e.route;if(B(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var i=rt(t,r),a=H(i).length;(r===t||a>0)&&(a>0&&(e.params=i),n.next(e))}else n.error(new Error(s))},error:n.error,complete:n.complete});return function(){if(r instanceof et){var n=r.__paths__,e=n.indexOf(t);e>-1&&n.splice(e,1)}i.unsubscribe()}}))}},deparam:function(t){return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){try{e.search=I(e.search,t),e.hashSearch=I(e.hashSearch,t),n.next(e)}catch(t){n.error(t)}},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){if(t instanceof et){var r=t.__paths__;if(r.length>0){var o=e.route,i=!1;D(r,(function(t){if(t===o||H(rt(t,o)).length)return!(i=!0)})),i||(e.noMatch=!0,n.next(e))}}},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,r=arguments.length>1?arguments[1]:void 0,o={};return e(t)===y&&(r=t,t=h),function(e){return new n.Observable((function(n){var i=e.subscribe({next:function(e){D(t,(function(t){if(r&&j(e[t])&&j(o[t])){var i={};if(ot(e[t],o[t],i),i.break)return a(o,e),n.next(e),!1}else if(e[t]!==o[t])return a(o,e),n.next(e),!1}))},error:n.error,complete:n.complete});return function(){i.unsubscribe(),o={}}}))}}});t.Router=et,t.operators=it,Object.defineProperty(t,"__esModule",{value:!0})}));
