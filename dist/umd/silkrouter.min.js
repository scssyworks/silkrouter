!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";const s=/:[^/]+/g,n=/^\/(?=[^?]*)/,o="Route string is not a pure route",i="vpushstate",r="?",a="",h=void 0,c=typeof a,u="boolean",l=typeof h,p="State",f=`push${p}`,b=`replace${p}`;var y=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},d=function(t){return"object"==typeof t&&null!==t};const g=Object.keys;function m(t){return typeof t===c?t.trim():a}function x(t,e){if(d(t)){const s=g(t);for(let n=0;n<s.length;n++){const o=s[n],i=e(t[o],y(o)?+o:o);if(typeof i===u&&!i)break}}}function v(t,e,s){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===c&&x(t,(t=>{const n=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s||[]});t.dispatchEvent(n)}))}function w(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[s,c]=t.split(r),{replace:u=!1,preventDefault:l=!1,queryString:p=c,data:y,pageTitle:d=null}=e,{preservePath:g,hashRouting:x,history:w,context:R}=this.config;if(!function(t){return n.test(t)}(t=m(s)))throw new TypeError(o);{const e=t;x&&(t=`${g?"":"/"}#${t}`),t=`${t}${m(p?`${r+p}`:a)}`;const s=w.state||{idx:0};w[u?b:f]({data:y,idx:s.idx+1},d,t),!l&&e&&v(R,i,[{path:e,hash:x},h,this])}}const R=(t,e)=>m(t?e.hash.substring(1).split(r)[0]:e.pathname);class _{constructor(t,e){const[s,n,o]=t,{location:i,history:a}=o.config;this.route=s.path,this.isHashRoute=s.hash,this.router=o,this.currentEvent=n||e,this.query={path:m(i.search.substring(1)),hash:m(i.hash.split(r)[1])};const{state:h}=n||{},{data:c,idx:u=0}=h||a.state||{};this.data=c,this.index=u}}function j(){return t=>new e.Observable((e=>{const s=t.subscribe({next:t=>{t.detail[2]===this&&e.next(new _(t.detail,t))},error:e.error,complete:e.complete});return()=>{s.unsubscribe()}}))}function E(t){const{hashRouting:s,location:n,init:o}=this.config,i=R(s,n);return n=>new e.Observable((e=>{const r=n.subscribe(e);return t||(t=!0,o&&i&&e.next(new _([{path:i,hash:s},h,this]))),()=>{r.unsubscribe()}}))}class ${static get global(){return typeof globalThis!==l?globalThis:global||self}constructor(t){let{history:s,context:n,location:o,hash:r}=t;if(!s[f])throw new Error("History unsupported!");this.__paths__=[],this.popStateSubscription=e.fromEvent($.global,"popstate").subscribe((t=>{const e=R(r,o);e&&v(n,i,[{path:e,hash:r},t,this])})),this.listeners=e.fromEvent(n,i).pipe(j.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.listeners.pipe(E.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}t.Router=class extends ${constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{history:e,location:s,document:n}=$.global,o=n.body;super({history:e,location:s,context:o,hash:t.hashRouting}),this.config=Object.freeze({init:!0,hashRouting:!1,preservePath:!1,context:o,history:e,location:s,...t}),t.hashRouting&&!s.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){w.apply(this,[t,e])}},t.RouterCore=$,t.resolveParams=function(t,e){const n={};if(s.test(t)){const o=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,o.test(e)){const i=Array.from(t.match(s)).map((t=>t.replace(":",a))),r=Array.from(e.match(o));r.shift(),x(i,((t,e)=>{n[t]=r[e]}))}}return n},Object.defineProperty(t,"__esModule",{value:!0})}));
