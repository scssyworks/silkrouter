!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,n){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=/:[^/]+/g,a=/^\/(?=[^?]*)/,u="Route string is not a pure route",c="vpushstate",s=["route","hashRouting","path","hash","search","hashSearch","data"],f="?",h="",l=void 0,p=e(h),b=e(!0),v=e(l),y=e({});e(0);var m=e((function(){})),d="State",g="push".concat(d),w="replace".concat(d);function _(){return("undefined"==typeof globalThis?"undefined":e(globalThis))!==v?globalThis:global||self}var x=Array.isArray,E=Object.keys;function S(t){return e(t)===p?t.trim():h}function O(t){return t&&e(t)===y}function j(t){return e(t)===p&&a.test(t)}function A(t,n){if(O(t))for(var r=E(t),o=0;o<r.length;o++){var i=r[o],a=n(t[i],("number"==typeof(u=i)?u-u==0:"string"==typeof u&&""!==u.trim()&&(Number.isFinite?Number.isFinite(+u):isFinite(+u)))?+i:i);if(e(a)===b){if(a)continue;break}}var u}var C=_();if(e(C.CustomEvent)===v){var R=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:l};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};R.prototype=C.Event.prototype,C.CustomEvent=R}function k(t,n){O(t)&&A(t,(function(t,e){n[e]=t}))}function N(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=O(n[0])?n[0]:{};return A(n,(function(t){k(t,r)})),r}Array.from||(Array.from=function(t){if(x(t))return t;var n=[];return A(t,(function(t){n.push(t)})),n});var T=_();function F(t,n,r){(t=Array.from(t instanceof Node?[t]:t)).length&&e(n)===p&&A(t,(function(t){var e=new T.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(e)}))}var I=function t(n,e){r(this,t);var o=n[0],i=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=S(c.pathname),this.hash=c.hash,this.search=S(c.search.substring(1)),this.hashSearch=S(c.hash&&c.hash.split(f)[1]);var h=this.originalEvent.state;this.data=h&&h.data||s.state&&s.state.data};function P(){var t=this;return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){e.detail[2]===t&&n.next(new I(e.detail,e))},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}}function M(){var t=this,e=this.config,r=e.context,o=e.location,i=e.hashRouting;this.popStateSubscription=n.fromEvent(_(),"popstate").subscribe((function(n){var e=S(i?o.hash.substring(1).split(f)[0]:o.pathname);e&&F(r,c,[{path:e,hash:i},n,t])})),this.listeners=n.fromEvent(r,c).pipe(P.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function U(t,n,r){O(r)?A(r,(function(e,o){U(t,"".concat(n,"[").concat(x(r)?h:o,"]"),e)})):e(r)!==m&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r)))}function q(t){var n=[];return O(t)?(A(t,(function(t,e){U(n,e,t)})),n.join("&")):e(t)===p?t:h}function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var L=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},Q=void 0,B=z(Q),D=z(""),G=("undefined"==typeof window?"undefined":z(window))!==B,H=G?window.location:null,J=Array.isArray;function K(t){return-1===["__proto__","prototype"].indexOf(t)}function V(t){return/\[/.test(t)}function W(){return Object.create(null)}function X(t,n){var e=this;G&&z(t)!==D&&(t=H.search);var r=(t=t.substring("?"===t.charAt(0))).split("&"),o=W();return t&&r.forEach((function(t){var r=t.split("=").map((function(t){return decodeURIComponent(t)}));V(r[0])?$.apply(e,[].concat(r).concat([o,n])):tt.apply(e,[r,o,!1,n])})),o}function Y(t,n){return z(t)===B?n?[]:W():n?t:(e=t,r=W(),J(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function Z(t,n){return"object"!==z(e=t)||null===e||J(e)?J(t)||z(t)===B?{ob:Y(t,L(n))}:{ob:[t],push:null!==t}:{ob:t};var e}function $(t,n,e,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var i=o[1],a=o[2];if(V(t=t.replace(/\[([^\[]*)\]/,"")))""===a&&(a="0"),$(t=t.replace(/[^\[]+/,a),n,e[i]=Z(e[i],a).ob,r);else if(a){if(K(i)&&K(a)){var u=Z(e[i],a),c=u.ob,s=u.push;e[i]=c;var f=s?W():e[i];f[a]=nt(n,!r),s&&e[i].push(f)}}else tt([o[1],n],e,!0,r)}}function tt(t,n,e,r){var o=t[0],i=t[1];K(o)&&(i=nt(i,!r),!function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(n,o)?n[o]=e?[i]:i:(n[o]=J(n[o])?n[o]:[n[o]],n[o].push(i)))}function nt(t,n){if(null==t)return"";if(n||z(t)!==D)return t;if(t=t.trim(),L(t))return+t;switch(t){case"null":return null;case B:return Q;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function et(t,n){var e=this.config.location,r=S(e.search&&e.search.substring(1)),o=S(n?e.hash.split(f)[1]:r);return o?q(N(X(r),X(o),X(t))):t}function rt(t,n,r){r=r||!0;var o=this.config,i=o.preservePath,a=o.hashRouting,s=o.history,b=N({replace:n,exec:r},e(t)===p?{route:t}:t);n=b.replace,r=b.exec;var v=b.route,y=b.queryString,m=b.preserveQuery,d=b.data,_=b.pageTitle,x=void 0===_?null:_,E=v.split(f);if(O(y)&&(y=q(y)),y=S(y||E[1]),v=S(E[0]),m&&(y=et.apply(this,[y,a])),!j(v))throw new TypeError(u);var A=v;return a&&(v="/#".concat(v),i&&(v="".concat(v.substring(1)))),v="".concat(v).concat(y?"".concat(f+y):h),s[n?w:g]({data:d},x,v),r&&A&&F(this.config.context,c,[{path:A,hash:a},l,this]),this}function ot(t){var e=this,r=this.config,o=r.hashRouting,i=r.location,a=r.init,u=S(o?i.hash.substring(1).split(f)[0]:i.pathname);return function(r){return new n.Observable((function(n){var i=r.subscribe(n);return t||(t=!0,a&&u&&n.next(new I([{path:u,hash:o},l,e]))),function(){i.unsubscribe()}}))}}var it=function(){function t(n){r(this,t);var e=_(),o=e.history,i=e.location,a=e.document;if(!o[g])throw new Error("Current browser does not support history object");this.config=Object.freeze(N({init:!0,hashRouting:!1,preservePath:!1,context:a.body,location:i,history:o},n||{})),this.__paths__=[],M.apply(this)}var n,i,a;return n=t,(i=[{key:"pipe",value:function(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[ot.apply(this)].concat(e))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(ot.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return rt.apply(this,n)}},{key:"destroy",value:function(t){e(t)===m&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(n.prototype,i),a&&o(n,a),t}();function at(t,n){var e={};if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(i.lastIndex=0,r.test(n)){var o=Array.from(t.match(i)).map((function(t){return t.replace(":",h)})),a=Array.from(n.match(r));a.shift(),A(o,(function(t,n){e[t]=a[n]}))}}return e}function ut(t,n,e){A(E(t),(function(r){O(t[r])&&O(n[r])?ut(t[r],n[r],e):e.break=t[r]!==n[r]}))}var ct=Object.freeze({__proto__:null,route:function(t,r,o){if(e(r)===b&&(o=r,r=l),t=S(t),r instanceof it){var i=r.__paths__;-1===i.indexOf(t)&&i.push(t)}return function(e){return new n.Observable((function(n){var i=e.subscribe({next:function(e){var r=e.route;if(j(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var i=at(t,r),a=E(i).length;(r===t||a>0)&&(a>0&&(e.params=i),n.next(e))}else n.error(new Error(u))},error:n.error,complete:n.complete});return function(){if(r instanceof it){var n=r.__paths__,e=n.indexOf(t);e>-1&&n.splice(e,1)}i.unsubscribe()}}))}},deparam:function(t){return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){try{e.search=X(e.search,t),e.hashSearch=X(e.hashSearch,t),n.next(e)}catch(t){n.error(t)}},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(e){return new n.Observable((function(n){var r=e.subscribe({next:function(e){if(t instanceof it){var r=t.__paths__;if(r.length>0){var o=e.route,i=!1;A(r,(function(t){if(t===o||E(at(t,o)).length)return!(i=!0)})),i||(e.noMatch=!0,n.next(e))}}},error:n.error,complete:n.complete});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,r=arguments.length>1?arguments[1]:void 0,o={};return e(t)===b&&(r=t,t=s),function(e){return new n.Observable((function(n){var i=e.subscribe({next:function(e){A(t,(function(t){if(r&&O(e[t])&&O(o[t])){var i={};if(ut(e[t],o[t],i),i.break)return N(o,e),n.next(e),!1}else if(e[t]!==o[t])return N(o,e),n.next(e),!1}))},error:n.error,complete:n.complete});return function(){i.unsubscribe(),o={}}}))}}});t.Router=it,t.operators=ct,Object.defineProperty(t,"__esModule",{value:!0})}));
