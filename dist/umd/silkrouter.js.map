{"version":3,"file":"silkrouter.js","sources":["../../src/js/utils/constants.js","../../src/js/utils/getGlobal.js","../../node_modules/deparam.js/dist/esm/deparam.esm.js","../../src/js/utils/utils.js","../../src/js/utils/polyfills.js","../../src/js/utils/assign.js","../../src/js/utils/triggerEvent.js","../../src/js/api/routerEvent/index.js","../../src/js/api/collate/index.js","../../src/js/api/bindRouterEvents/index.js","../../src/js/utils/query.js","../../src/js/api/resolveQuery/index.js","../../src/js/api/set/index.js","../../src/js/api/callOnce/index.js","../../src/js/api/router/index.js","../../src/js/utils/params.js","../../src/js/operators/index.js"],"sourcesContent":["/**\n * Router constants\n */\nexport const POP_STATE = 'popstate';\nexport const REG_ROUTE_PARAMS = /:[^/]+/g;\nexport const REG_PATHNAME = /^\\/(?=[^?]*)/;\nexport const REG_COMPLEX = /\\[/;\nexport const REG_VARIABLE = /([^[]+)\\[([^[]*)\\]/;\nexport const REG_REPLACE_BRACKETS = /\\[([^[]*)\\]/;\nexport const REG_REPLACE_NEXTPROP = /[^[]+/;\nexport const HISTORY_UNSUPPORTED =\n  'Current browser does not support history object';\nexport const INVALID_ROUTE = 'Route string is not a pure route';\nexport const VIRTUAL_PUSHSTATE = 'vpushstate';\nexport const CACHED_FIELDS = [\n  'route',\n  'hashRouting',\n  'path',\n  'hash',\n  'search',\n  'hashSearch',\n  'data',\n];\nexport const AMP = '&';\nexport const QRY = '?';\nexport const EQ = '=';\nexport const EMPTY = '';\nexport const UNDEF = void 0;\nexport const TYPEOF_STR = typeof EMPTY;\nexport const TYPEOF_BOOL = typeof true;\nexport const TYPEOF_UNDEF = typeof UNDEF;\nexport const TYPEOF_OBJ = typeof {};\nexport const TYPEOF_NUM = typeof 0;\nexport const TYPEOF_FUNC = typeof (() => {});\nexport const STATE = 'State';\nexport const PUSH = `push${STATE}`;\nexport const REPLACE = `replace${STATE}`;\n","import { TYPEOF_UNDEF } from './constants';\n\nexport function getGlobal() {\n  return typeof globalThis !== TYPEOF_UNDEF ? globalThis : global || self;\n}\n","/*!\n * Deparam plugin converts query string to a valid JavaScript object\n * Released under MIT license\n * @name Deparam.js\n * @author Sachin Singh <https://github.com/scssyworks/deparam.js>\n * @version 3.0.6\n * @license MIT\n */\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\n/*!\n * is-number <https://github.com/jonschlinkert/is-number>\n *\n * Copyright (c) 2014-present, Jon Schlinkert.\n * Released under the MIT License.\n */\n\nvar isNumber = function(num) {\n  if (typeof num === 'number') {\n    return num - num === 0;\n  }\n  if (typeof num === 'string' && num.trim() !== '') {\n    return Number.isFinite ? Number.isFinite(+num) : isFinite(+num);\n  }\n  return false;\n};\n\nvar isObject = function isObject(x) {\n\treturn typeof x === 'object' && x !== null;\n};\n\nvar UNDEF = void 0; // Results to undefined\n// Typeof undefined\n\nvar TYPEOF_UNDEF = _typeof(UNDEF); // Typeof string\n\n\nvar TYPEOF_STR = _typeof(\"\"); // location var\n\n\nvar loc = (typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) !== TYPEOF_UNDEF ? window.location : null; // Shorthand for built-ins\n\nvar isArr = Array.isArray;\n/**\n * Checks if current key is safe\n * @param {string} key Current key\n * @returns {boolean}\n */\n\nfunction isSafe(key) {\n  return [\"__proto__\", \"prototype\"].indexOf(key) === -1;\n}\n/**\n * Shorthand for Object.prototype.hasOwnProperty\n * @param {any} obj Any object\n * @param {string} key key\n * @returns {boolean} true or false if object has the property\n */\n\n\nfunction hasOwn(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n/**\n * Returns true of input query string is complex\n * @param {string} q Query string\n * @returns {boolean} true or false\n */\n\n\nfunction ifComplex(q) {\n  return /\\[/.test(q);\n}\n/**\n * Returns an object without a prototype\n * @returns {{[key in string|number]: any}} Object without __proto__\n */\n\n\nfunction obNull() {\n  return Object.create(null);\n}\n/**\n * Returns a parsed query object\n * @param {string} qs Query string\n * @param {boolean} coerce Coerce values\n * @returns {{[key in string|number]: any}} Query object\n */\n\n\nfunction lib(qs, coerce) {\n  var _this = this;\n\n  if (_typeof(qs) !== TYPEOF_STR) {\n    qs = loc ? loc.search : \"\";\n  }\n\n  qs = qs.substring(qs.charAt(0) === \"?\");\n  var queryObject = obNull();\n\n  if (qs) {\n    qs.split(\"&\").forEach(function (qq) {\n      var qArr = qq.split(\"=\").map(function (part) {\n        return decodeURIComponent(part);\n      });\n\n      if (ifComplex(qArr[0])) {\n        complex.apply(_this, [].concat(qArr).concat([queryObject, coerce]));\n      } else {\n        simple.apply(_this, [qArr, queryObject, false, coerce]);\n      }\n    });\n  }\n\n  return queryObject;\n}\n/**\n * Converts an array to equivalent object\n * @param {any[]} arr Any array\n * @returns {any} Any object\n */\n\n\nfunction toObject(arr) {\n  var convertedObj = obNull();\n\n  if (isArr(arr)) {\n    arr.forEach(function (value, index) {\n      convertedObj[index] = value;\n    });\n  }\n\n  return convertedObj;\n}\n/**\n * Converts array to an object if required\n * @param {any} ob Any object\n * @param {booleab} isNextNumber Test for next key\n * @returns {any} Any object\n */\n\n\nfunction resolve(ob, isNextNumber) {\n  if (_typeof(ob) === TYPEOF_UNDEF) return isNextNumber ? [] : obNull();\n  return isNextNumber ? ob : toObject(ob);\n}\n/**\n * Resolves the target object for next iteration\n * @param {any} ob current reference object\n * @param {string} nextProp reference property in current object\n * @returns {any} Resolved object for next iteration\n */\n\n\nfunction resolveObj(ob, nextProp) {\n  if (isObject(ob) && !isArr(ob)) return {\n    ob: ob\n  };\n  if (isArr(ob) || _typeof(ob) === TYPEOF_UNDEF) return {\n    ob: resolve(ob, isNumber(nextProp))\n  };\n  return {\n    ob: [ob],\n    push: ob !== null\n  };\n}\n/**\n * Handles complex query parameters\n * @param {string} key Query key\n * @param {string} value Query value\n * @param {Object} obj Query object\n * @returns {void}\n */\n\n\nfunction complex(key, value, obj, doCoerce) {\n  var match = key.match(/([^\\[]+)\\[([^\\[]*)\\]/) || [];\n\n  if (match.length === 3) {\n    var prop = match[1];\n    var nextProp = match[2];\n    key = key.replace(/\\[([^\\[]*)\\]/, \"\");\n\n    if (ifComplex(key)) {\n      if (nextProp === \"\") nextProp = \"0\";\n      key = key.replace(/[^\\[]+/, nextProp);\n      complex(key, value, obj[prop] = resolveObj(obj[prop], nextProp).ob, doCoerce);\n    } else if (nextProp) {\n      if (isSafe(prop) && isSafe(nextProp)) {\n        var _resolveObj = resolveObj(obj[prop], nextProp),\n            ob = _resolveObj.ob,\n            push = _resolveObj.push;\n\n        obj[prop] = ob;\n        var nextOb = push ? obNull() : obj[prop];\n        nextOb[nextProp] = coerce(value, !doCoerce);\n\n        if (push) {\n          obj[prop].push(nextOb);\n        }\n      }\n    } else {\n      simple([match[1], value], obj, true, doCoerce);\n    }\n  }\n}\n/**\n * Handles simple query\n * @param {array} qArr Query list\n * @param {Object} queryObject Query object\n * @param {boolean} toArray Test for conversion to array\n * @returns {void}\n */\n\n\nfunction simple(qArr, queryObject, toArray, doCoerce) {\n  var key = qArr[0];\n  var value = qArr[1];\n\n  if (isSafe(key)) {\n    value = coerce(value, !doCoerce);\n\n    if (hasOwn(queryObject, key)) {\n      queryObject[key] = isArr(queryObject[key]) ? queryObject[key] : [queryObject[key]];\n      queryObject[key].push(value);\n    } else {\n      queryObject[key] = toArray ? [value] : value;\n    }\n  }\n}\n/**\n * Converts input value to their appropriate types\n * @param {any} value Input value\n * @param {boolean} skip Test for skipping coercion\n * @returns {any} Coerced value\n */\n\n\nfunction coerce(value, skip) {\n  // eslint-disable-next-line\n  if (value == null) {\n    return \"\";\n  }\n\n  if (skip || _typeof(value) !== TYPEOF_STR) {\n    return value;\n  }\n\n  value = value.trim();\n\n  if (isNumber(value)) {\n    return +value;\n  }\n\n  switch (value) {\n    case \"null\":\n      return null;\n\n    case TYPEOF_UNDEF:\n      return UNDEF;\n\n    case \"true\":\n      return true;\n\n    case \"false\":\n      return false;\n\n    case \"NaN\":\n      return NaN;\n\n    default:\n      return value;\n  }\n}\n\nexport { lib as default, isNumber, isObject };\n//# sourceMappingURL=deparam.esm.js.map\n","import { isNumber, isObject } from \"deparam.js\";\nimport { EMPTY, REG_PATHNAME, TYPEOF_BOOL, TYPEOF_STR } from \"./constants\";\n\n/**\n * Shorthand for Array.isArray\n */\nexport const isArr = Array.isArray;\n\n/**\n * Shorthand for Object.keys\n */\nexport const oKeys = Object.keys;\n\n/**\n * Safely trims string\n * @param {string} str String\n */\nexport function trim(str) {\n  return typeof str === TYPEOF_STR ? str.trim() : EMPTY;\n}\n\n/**\n * Checks if given route is valid\n * @private\n * @param {string} route Route string\n */\nexport function isValidRoute(route) {\n  return typeof route === TYPEOF_STR && REG_PATHNAME.test(route);\n}\n\n/**\n * Checks if key is present in provided object\n * @param {object} ob Object\n * @param {*} key Key\n */\nexport function hasOwn(ob, key) {\n  return Object.prototype.hasOwnProperty.call(ob, key);\n}\n\n/**\n * Loops over an array like object\n * @param {object} arrayObj Array or array like object\n * @param {function} callback Callback function\n */\nexport function each(arrayObj, callback) {\n  if (isObject(arrayObj)) {\n    const keys = oKeys(arrayObj);\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const cont = callback(arrayObj[key], isNumber(key) ? +key : key);\n      if (typeof cont === TYPEOF_BOOL) {\n        if (cont) {\n          continue;\n        } else {\n          break;\n        }\n      }\n    }\n  }\n}\n","import { TYPEOF_UNDEF, UNDEF } from './constants';\nimport { getGlobal } from './getGlobal';\nimport { each, isArr } from './utils';\n\n// Polyfill custom event\nconst g = getGlobal();\nif (typeof g.CustomEvent === TYPEOF_UNDEF) {\n  const CustomEvent = function (event, params) {\n    params = params || { bubbles: false, cancelable: false, detail: UNDEF };\n    const evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(\n      event,\n      params.bubbles,\n      params.cancelable,\n      params.detail\n    );\n    return evt;\n  };\n\n  CustomEvent.prototype = g.Event.prototype;\n  g.CustomEvent = CustomEvent;\n}\n\n// Polyfill Array.from\n\nif (!Array.from) {\n  Array.from = function (arrayLike) {\n    if (isArr(arrayLike)) {\n      return arrayLike;\n    }\n    const arr = [];\n    each(arrayLike, (value) => {\n      arr.push(value);\n    });\n    return arr;\n  };\n}\n","import { isObject } from \"deparam.js\";\nimport { each } from \"./utils\";\n\n/**\n * Inner loop function for assign\n * @private\n * @param {object} ref Argument object\n * @param {object} target First object\n */\nfunction loopFunc(ref, target) {\n  if (isObject(ref)) {\n    each(ref, (prop, key) => {\n      target[key] = prop;\n    });\n  }\n}\n\n/**\n * Polyfill for Object.assign only smaller and with less features\n * @private\n * @returns {object}\n */\nexport function assign(...args) {\n  const target = isObject(args[0]) ? args[0] : {};\n  each(args, (arg) => {\n    loopFunc(arg, target);\n  });\n  return target;\n}\n","import { TYPEOF_STR } from './constants';\nimport { getGlobal } from './getGlobal';\nimport { each } from './utils';\n\nconst g = getGlobal();\n\n/**\n * Function to trigger custom event\n * @param {Node|NodeList|HTMLCollection|Node[]} target Target element or list\n * @param {string} eventType Event type\n * @param {any[]} data Data to be passed to handler\n */\nexport function trigger(target, eventType, data) {\n  target = Array.from(target instanceof Node ? [target] : target);\n  if (target.length && typeof eventType === TYPEOF_STR) {\n    each(target, (el) => {\n      const customEvent = new g.CustomEvent(eventType, {\n        bubbles: true,\n        cancelable: true,\n        detail: data || [],\n      });\n      el.dispatchEvent(customEvent);\n    });\n  }\n}\n","import { QRY } from '../../utils/constants';\nimport { trim } from '../../utils/utils';\nexport default class RouterEvent {\n  constructor(routeInfo, currentEvent) {\n    // Set relevant parameters\n    const routeObject = routeInfo[0];\n    const originalEvent = routeInfo[1];\n    const routerInstance = routeInfo[2];\n    const { location, history } = routerInstance.config;\n    this.route = routeObject.path;\n    this.hashRouting = routeObject.hash;\n    this.routerInstance = routerInstance;\n    this.virtualEvent = currentEvent || {};\n    this.originalEvent = originalEvent || {};\n    this.path = trim(location.pathname);\n    this.hash = location.hash;\n    this.search = trim(location.search.substring(1));\n    this.hashSearch = trim(location.hash && location.hash.split(QRY)[1]);\n    const { state } = this.originalEvent;\n    this.data = (state && state.data) || (history.state && history.state.data);\n  }\n}\n","import { Observable } from 'rxjs';\nimport RouterEvent from '../routerEvent';\n\nexport default function collate() {\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe({\n        next: (event) => {\n          const routerInstance = event.detail[2];\n          if (routerInstance === this) {\n            subscriber.next(new RouterEvent(event.detail, event));\n          }\n        },\n        error: subscriber.error,\n        complete: subscriber.complete,\n      });\n      return () => {\n        subn.unsubscribe();\n      };\n    });\n}\n","import { fromEvent } from 'rxjs';\nimport { POP_STATE, QRY, VIRTUAL_PUSHSTATE } from '../../utils/constants';\nimport { trigger } from '../../utils/triggerEvent';\nimport collate from '../collate';\nimport { trim } from '../../utils/utils';\nimport { getGlobal } from '../../utils/getGlobal';\n\nexport default function bindRouterEvents() {\n  const { context, location, hashRouting } = this.config;\n  this.popStateSubscription = fromEvent(getGlobal(), POP_STATE).subscribe(\n    (e) => {\n      const path = trim(\n        hashRouting\n          ? location.hash.substring(1).split(QRY)[0]\n          : location.pathname\n      );\n      if (path) {\n        trigger(context, VIRTUAL_PUSHSTATE, [\n          { path, hash: hashRouting },\n          e,\n          this,\n        ]);\n      }\n    }\n  );\n  this.listeners = fromEvent(context, VIRTUAL_PUSHSTATE).pipe(\n    collate.apply(this)\n  );\n  if (hashRouting && !location.hash) {\n    this.set('/', true, false); // Replace current hash path without executing anythings\n  }\n}\n","import { isObject } from \"deparam.js\";\nimport { AMP, EMPTY, TYPEOF_FUNC, TYPEOF_STR } from \"./constants\";\nimport { each, isArr } from \"./utils\";\n\n/**\n * Builds query string recursively\n * @private\n * @param {string[]} qsList List of query string key value pairs\n * @param {*} key Key\n * @param {*} obj Value\n */\nfunction buildQuery(qsList, key, obj) {\n  if (isObject(obj)) {\n    each(obj, (prop, obKey) => {\n      buildQuery(qsList, `${key}[${isArr(obj) ? EMPTY : obKey}]`, prop);\n    });\n  } else if (typeof obj !== TYPEOF_FUNC) {\n    qsList.push(`${encodeURIComponent(key)}=${encodeURIComponent(obj)}`);\n  }\n}\n\n/**\n * Converts an object to a query string\n * @private\n * @param {object} obj Object which should be converted to a string\n * @returns {string}\n */\nexport function toQueryString(obj) {\n  let qsList = [];\n  if (isObject(obj)) {\n    each(obj, (prop, key) => {\n      buildQuery(qsList, key, prop);\n    });\n    return qsList.join(AMP);\n  }\n  return typeof obj === TYPEOF_STR ? obj : EMPTY;\n}\n","import deparam from 'deparam.js';\nimport { trim } from '../../utils/utils';\nimport { toQueryString } from '../../utils/query';\nimport { assign } from '../../utils/assign';\nimport { QRY } from '../../utils/constants';\n\n/**\n * Resolves and analyzes existing query string\n * @private\n * @param {string} queryString Query string\n * @param {string} hashRouting Flag to test if hash routing is enabled\n */\nexport default function resolveQuery(queryString, hashRouting) {\n  const { location } = this.config;\n  const search = trim(location.search && location.search.substring(1));\n  const existingQuery = hashRouting\n    ? trim(location.hash.split(QRY)[1])\n    : trim(search);\n  if (!existingQuery) return queryString;\n  return toQueryString(\n    assign(deparam(search), deparam(existingQuery), deparam(queryString))\n  );\n}\n","import { isObject } from \"deparam.js\";\nimport { trigger } from \"../../utils/triggerEvent\";\nimport {\n  VIRTUAL_PUSHSTATE,\n  INVALID_ROUTE,\n  UNDEF,\n  TYPEOF_STR,\n  EMPTY,\n  QRY,\n  REPLACE,\n  PUSH,\n} from \"../../utils/constants\";\nimport { isValidRoute, trim } from \"../../utils/utils\";\nimport { toQueryString } from \"../../utils/query\";\nimport resolveQuery from \"../resolveQuery\";\nimport { assign } from \"../../utils/assign\";\n\nexport default function set(route, replace, exec) {\n  exec = exec || true;\n  const { preservePath, hashRouting, history } = this.config;\n  const routeObject = assign(\n    { replace, exec },\n    typeof route === TYPEOF_STR ? { route } : route\n  );\n  replace = routeObject.replace;\n  exec = routeObject.exec;\n  let { route: routeStr, queryString } = routeObject;\n  const { preserveQuery, data, pageTitle = null } = routeObject;\n  const routeParts = routeStr.split(QRY);\n  // Check if query string is an object\n  if (isObject(queryString)) {\n    queryString = toQueryString(queryString);\n  }\n  // Resolve to URL query string if it's not explicitly passed\n  queryString = trim(queryString ? queryString : routeParts[1]);\n  routeStr = trim(routeParts[0]);\n  // Check if query preservation is required. Resolve query accordingly\n  if (preserveQuery) {\n    queryString = resolveQuery.apply(this, [queryString, hashRouting]);\n  }\n  if (isValidRoute(routeStr)) {\n    const unmodifiedRoute = routeStr;\n    if (hashRouting) {\n      routeStr = `/#${routeStr}`;\n      // Path preservation should only work for hash routing\n      if (preservePath) {\n        routeStr = `${routeStr.substring(1)}`;\n      }\n    }\n    // Append query string\n    routeStr = `${routeStr}${queryString ? `${QRY + queryString}` : EMPTY}`;\n    history[replace ? REPLACE : PUSH]({ data }, pageTitle, routeStr);\n    if (exec && unmodifiedRoute) {\n      trigger(this.config.context, VIRTUAL_PUSHSTATE, [\n        {\n          path: unmodifiedRoute,\n          hash: hashRouting,\n        },\n        UNDEF,\n        this,\n      ]);\n    }\n  } else {\n    throw new TypeError(INVALID_ROUTE);\n  }\n  return this;\n}\n","import { Observable } from 'rxjs';\nimport { QRY, UNDEF } from '../../utils/constants';\nimport { trim } from '../../utils/utils';\nimport RouterEvent from '../routerEvent';\n\nexport default function callOnce(isDone) {\n  const { hashRouting: hash, location, init } = this.config;\n  const path = trim(\n    hash ? location.hash.substring(1).split(QRY)[0] : location.pathname\n  );\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe(subscriber);\n      if (!isDone) {\n        isDone = true;\n        if (init && path) {\n          subscriber.next(new RouterEvent([{ path, hash }, UNDEF, this]));\n        }\n      }\n      return () => {\n        subn.unsubscribe();\n      };\n    });\n}\n","import { assign } from '../../utils/assign';\nimport bindRouterEvents from '../bindRouterEvents';\nimport set from '../set';\nimport { HISTORY_UNSUPPORTED, PUSH, TYPEOF_FUNC } from '../../utils/constants';\nimport callOnce from '../callOnce';\nimport { getGlobal } from '../../utils/getGlobal';\n\nexport default class Router {\n  constructor(config) {\n    const { history, location, document } = getGlobal();\n    if (!history[PUSH]) {\n      throw new Error(HISTORY_UNSUPPORTED);\n    }\n    this.config = Object.freeze(\n      assign(\n        {\n          init: true, // Initialize as soon as route handler is attached\n          hashRouting: false, // Switch to hash routing\n          preservePath: false, // Works for hash routing\n          context: document.body, // To change the context of \"vpushstate\" event\n          location, // Should remain unchanged\n          history, // History object\n        },\n        config || {}\n      )\n    );\n    this.__paths__ = [];\n    bindRouterEvents.apply(this);\n  }\n  pipe(...ops) {\n    return this.listeners.pipe(callOnce.apply(this), ...ops);\n  }\n  subscribe(...fns) {\n    return this.listeners.pipe(callOnce.apply(this)).subscribe(...fns);\n  }\n  set(...props) {\n    return set.apply(this, props);\n  }\n  destroy(callback) {\n    if (typeof callback === TYPEOF_FUNC) {\n      callback();\n    }\n    this.popStateSubscription.unsubscribe(); // Unsubscribe popstate event\n    this.__paths__.length = 0;\n  }\n}\n","import { EMPTY, REG_ROUTE_PARAMS } from './constants';\nimport { each } from './utils';\n\n/**\n * Parses current path and returns params object\n * @private\n * @param {string} expr Route expression\n * @param {string} path URL path\n * @returns {object}\n */\nexport function extractParams(expr, path) {\n  const params = {};\n  if (REG_ROUTE_PARAMS.test(expr)) {\n    const pathRegex = new RegExp(\n      expr.replace(/\\//g, '\\\\/').replace(/:[^/\\\\]+/g, '([^\\\\/]+)')\n    );\n    REG_ROUTE_PARAMS.lastIndex = 0;\n    if (pathRegex.test(path)) {\n      const keys = Array.from(expr.match(REG_ROUTE_PARAMS)).map((key) =>\n        key.replace(':', EMPTY)\n      );\n      const values = Array.from(path.match(pathRegex));\n      values.shift();\n      each(keys, (key, index) => {\n        params[key] = values[index];\n      });\n    }\n  }\n  return params;\n}\n","import { trim, isValidRoute, each, oKeys } from \"../utils/utils\";\nimport queryDeparam, { isObject } from \"deparam.js\";\nimport { Observable } from \"rxjs\";\nimport {\n  INVALID_ROUTE,\n  CACHED_FIELDS,\n  UNDEF,\n  TYPEOF_BOOL,\n} from \"../utils/constants\";\nimport { extractParams } from \"../utils/params\";\nimport Router from \"../api/router\";\nimport { assign } from \"../utils/assign\";\n\n/**\n * Operator to compare a specific route\n * @param {string} routeStr Route string\n * @param {Router} routerInstance Current router object [optional]\n * @param {boolean} ignoreCase Ignore case in route string\n */\nexport function route(routeStr, routerInstance, ignoreCase) {\n  if (typeof routerInstance === TYPEOF_BOOL) {\n    ignoreCase = routerInstance;\n    routerInstance = UNDEF;\n  }\n  routeStr = trim(routeStr);\n  if (routerInstance instanceof Router) {\n    const paths = routerInstance.__paths__;\n    if (paths.indexOf(routeStr) === -1) {\n      paths.push(routeStr);\n    }\n  }\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe({\n        next(event) {\n          let incomingRoute = event.route;\n          if (isValidRoute(routeStr)) {\n            if (ignoreCase) {\n              routeStr = routeStr.toLowerCase();\n              incomingRoute = incomingRoute.toLowerCase();\n            }\n            const params = extractParams(routeStr, incomingRoute);\n            const paramsLength = oKeys(params).length;\n            if (incomingRoute === routeStr || paramsLength > 0) {\n              if (paramsLength > 0) {\n                event.params = params;\n              }\n              subscriber.next(event);\n            }\n          } else {\n            subscriber.error(new Error(INVALID_ROUTE));\n          }\n        },\n        error: subscriber.error,\n        complete: subscriber.complete,\n      });\n      return () => {\n        if (routerInstance instanceof Router) {\n          const paths = routerInstance.__paths__;\n          const existingRouteIndex = paths.indexOf(routeStr);\n          if (existingRouteIndex > -1) {\n            paths.splice(existingRouteIndex, 1);\n          }\n        }\n        subn.unsubscribe();\n      };\n    });\n}\n\n/**\n * Converts search and hashSearch strings to object\n * @param {boolean} coerce Flag to enable value typecast\n */\nexport function deparam(coerce) {\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe({\n        next(event) {\n          try {\n            event.search = queryDeparam(event.search, coerce);\n            event.hashSearch = queryDeparam(event.hashSearch, coerce);\n            subscriber.next(event);\n          } catch (e) {\n            subscriber.error(e);\n          }\n        },\n        error: subscriber.error,\n        complete: subscriber.complete,\n      });\n      return () => {\n        subn.unsubscribe();\n      };\n    });\n}\n\n/**\n * Modifies current subscriber to detect errors\n * @param {Router} routerInstance Current router object\n */\nexport function noMatch(routerInstance) {\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe({\n        next(event) {\n          if (routerInstance instanceof Router) {\n            const paths = routerInstance.__paths__;\n            if (paths.length > 0) {\n              const currentRoute = event.route;\n              let match = false;\n              each(paths, (path) => {\n                if (\n                  path === currentRoute ||\n                  oKeys(extractParams(path, currentRoute)).length\n                ) {\n                  return !(match = true);\n                }\n              });\n              if (!match) {\n                event.noMatch = true;\n                subscriber.next(event);\n              }\n            }\n          }\n        },\n        error: subscriber.error,\n        complete: subscriber.complete,\n      });\n      return () => {\n        subn.unsubscribe();\n      };\n    });\n}\n\nfunction deepComparison(first, second, result) {\n  each(oKeys(first), (key) => {\n    if (isObject(first[key]) && isObject(second[key])) {\n      deepComparison(first[key], second[key], result);\n    } else {\n      result.break = first[key] !== second[key];\n    }\n  });\n}\n\n/**\n * Caches incoming routes to avoid calling handler if there is no change\n * @param {string[]} keys\n * @param {boolean} deep\n */\nexport function cache(keys = CACHED_FIELDS, deep) {\n  let cache = {};\n  if (typeof keys === TYPEOF_BOOL) {\n    deep = keys;\n    keys = CACHED_FIELDS;\n  }\n  return (observable) =>\n    new Observable((subscriber) => {\n      const subn = observable.subscribe({\n        next(event) {\n          each(keys, (key) => {\n            if (deep && isObject(event[key]) && isObject(cache[key])) {\n              const result = {};\n              deepComparison(event[key], cache[key], result);\n              if (result.break) {\n                assign(cache, event);\n                subscriber.next(event);\n                return false;\n              }\n            } else if (event[key] !== cache[key]) {\n              assign(cache, event);\n              subscriber.next(event);\n              return false; // break loop\n            }\n          });\n        },\n        error: subscriber.error,\n        complete: subscriber.complete,\n      });\n      return () => {\n        subn.unsubscribe();\n        cache = {};\n      };\n    });\n}\n"],"names":["POP_STATE","REG_ROUTE_PARAMS","REG_PATHNAME","HISTORY_UNSUPPORTED","INVALID_ROUTE","VIRTUAL_PUSHSTATE","CACHED_FIELDS","AMP","QRY","EMPTY","UNDEF","TYPEOF_STR","TYPEOF_BOOL","_typeof","TYPEOF_UNDEF","TYPEOF_FUNC","STATE","PUSH","REPLACE","getGlobal","globalThis","global","self","isArr","Array","isArray","oKeys","Object","keys","trim","str","isValidRoute","route","test","each","arrayObj","callback","isObject","i","length","key","cont","isNumber","g","CustomEvent","event","params","bubbles","cancelable","detail","evt","document","createEvent","initCustomEvent","prototype","Event","from","arrayLike","arr","value","push","loopFunc","ref","target","prop","assign","args","arg","trigger","eventType","data","Node","el","customEvent","dispatchEvent","RouterEvent","routeInfo","currentEvent","routeObject","originalEvent","routerInstance","config","location","history","path","hashRouting","hash","virtualEvent","pathname","search","substring","hashSearch","split","state","collate","observable","Observable","subscriber","subn","subscribe","next","error","complete","unsubscribe","bindRouterEvents","context","popStateSubscription","fromEvent","e","listeners","pipe","apply","set","buildQuery","qsList","obj","obKey","encodeURIComponent","toQueryString","join","resolveQuery","queryString","existingQuery","deparam","replace","exec","preservePath","routeStr","preserveQuery","pageTitle","routeParts","unmodifiedRoute","TypeError","callOnce","isDone","init","Router","Error","freeze","body","__paths__","ops","props","extractParams","expr","pathRegex","RegExp","lastIndex","match","map","values","shift","index","ignoreCase","paths","indexOf","incomingRoute","toLowerCase","paramsLength","existingRouteIndex","splice","coerce","queryDeparam","noMatch","currentRoute","deepComparison","first","second","result","cache","deep"],"mappings":"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"}