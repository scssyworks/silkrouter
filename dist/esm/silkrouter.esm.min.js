import{Observable as t,fromEvent as n}from"rxjs";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(){return Object.assign.apply(Object,arguments)}var u=/:[^/]+/g,c=/^\/(?=[^?]*)/,s=["route","hashRouting","path","hash","search","hashSearch","data"],f=e(""),h=e(!0),p=e(undefined);e({}),e(0);var l=e((function(){})),b="push".concat("State"),v="replace".concat("State");function y(){return("undefined"==typeof globalThis?"undefined":e(globalThis))!==p?globalThis:global||self}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}var m=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},g=function(t){return"object"==typeof t&&null!==t},w=d(undefined),_=d(""),x=("undefined"==typeof window?"undefined":d(window))!==w?window.location:null,S=Array.isArray;function O(t){return-1===["__proto__","prototype"].indexOf(t)}function j(t){return/\[/.test(t)}function E(){return Object.create(null)}function R(t,n){var e=this;d(t)!==_&&(t=x?x.search:""),t=t.substring("?"===t.charAt(0));var r=E();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));j(o[0])?N.apply(e,[].concat(o).concat([r,n])):C.apply(e,[o,r,!1,n])})),r}function A(t,n){return d(t)===w?n?[]:E():n?t:(e=t,r=E(),S(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function k(t,n){return g(t)&&!S(t)?{ob:t}:S(t)||d(t)===w?{ob:A(t,m(n))}:{ob:[t],push:null!==t}}function N(t,n,e,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var i=o[1],a=o[2];if(j(t=t.replace(/\[([^\[]*)\]/,"")))""===a&&(a="0"),N(t=t.replace(/[^\[]+/,a),n,e[i]=k(e[i],a).ob,r);else if(a){if(O(i)&&O(a)){var u=k(e[i],a),c=u.ob,s=u.push;e[i]=c;var f=s?E():e[i];f[a]=T(n,!r),s&&e[i].push(f)}}else C([o[1],n],e,!0,r)}}function C(t,n,e,r){var o=t[0],i=t[1];O(o)&&(i=T(i,!r),!function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(n,o)?n[o]=e?[i]:i:(n[o]=S(n[o])?n[o]:[n[o]],n[o].push(i)))}function T(t,n){if(null==t)return"";if(n||d(t)!==_)return t;if(t=t.trim(),m(t))return+t;switch(t){case"null":return null;case w:return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}var P=Array.isArray,I=Object.keys;function F(t){return e(t)===f?t.trim():""}function z(t){return c.test(t)}function L(t,n){if(g(t))for(var r=I(t),o=0;o<r.length;o++){var i=r[o],a=n(t[i],m(i)?+i:i);if(e(a)===h&&!a)break}}function M(t,n,r){(t=Array.from(t instanceof Node?[t]:t)).length&&e(n)===f&&L(t,(function(t){var e=new(y().CustomEvent)(n,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(e)}))}var U=i((function t(n,e){r(this,t);var o=n[0],i=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=F(c.pathname),this.hash=c.hash,this.search=F(c.search.substring(1)),this.hashSearch=F(c.hash&&c.hash.split("?")[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data}));function q(){var n=this;return function(e){return new t((function(t){var r=e.subscribe({next:function(e){e.detail[2]===n&&t.next(new U(e.detail,e))},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}}var H=function(t,n){return F(t?n.hash.substring(1).split("?")[0]:n.pathname)};function Q(t){var e=t.config,r=e.context,o=e.location,i=e.hashRouting;t.popStateSubscription=n(y(),"popstate").subscribe((function(n){var e=H(i,o);e&&M(r,"vpushstate",[{path:e,hash:i},n,t])})),t.listeners=n(r,"vpushstate").pipe(q.apply(t)),i&&!o.hash&&t.set("/",!0,!1)}var B=encodeURIComponent;function D(t,n,r){g(r)?L(r,(function(e,o){D(t,"".concat(n,"[").concat(P(r)?"":o,"]"),e)})):e(r)!==l&&t.push("".concat(B(n),"=").concat(B(r)))}function G(t){var n=[];return g(t)?(L(t,(function(t,e){D(n,e,t)})),n.join("&")):e(t)===f?t:""}function J(t,n){var e=this.config.location,r=F(e.search&&e.search.substring(1)),o=F(n?e.hash.split("?")[1]:r);return o?G(a(R(r),R(o),R(t))):t}function K(t,n,r){var o=!0;e(r)===h&&(o=r);var i=this.config,u=i.preservePath,c=i.hashRouting,s=i.history,p=a({replace:n,exec:o},e(t)===f?{route:t}:t);n=p.replace,o=p.exec;var l=p.route,y=p.queryString,d=p.preserveQuery,m=p.data,w=p.pageTitle,_=void 0===w?null:w,x=l.split("?");if(g(y)&&(y=G(y)),y=F(y||x[1]),l=F(x[0]),d&&(y=J.apply(this,[y,c])),!z(l))throw new TypeError("Route string is not a pure route");var S=l;return c&&(l="/#".concat(l),u&&(l="".concat(l.substring(1)))),l="".concat(l).concat(y?"".concat("?"+y):""),s[n?v:b]({data:m},_,l),o&&S&&M(this.config.context,"vpushstate",[{path:S,hash:c},undefined,this]),this}function V(n){var e=this,r=this.config,o=r.hashRouting,i=r.location,a=r.init,u=H(o,i);return function(r){return new t((function(t){var i=r.subscribe(t);return n||(n=!0,a&&u&&t.next(new U([{path:u,hash:o},undefined,e]))),function(){i.unsubscribe()}}))}}var W=function(){function t(n){r(this,t);var e=y(),o=e.history,i=e.location,u=e.document;if(!o[b])throw new Error("History unsupported!");this.config=Object.freeze(a({init:!0,hashRouting:!1,preservePath:!1,context:u.body,location:i,history:o},n||{})),this.__paths__=[],Q(this)}return i(t,[{key:"pipe",value:function(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[V.apply(this)].concat(e))}},{key:"subscribe",value:function(){var t;return(t=this.pipe()).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return K.apply(this,n)}},{key:"destroy",value:function(t){e(t)===l&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function X(t,n){var e={};if(u.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(u.lastIndex=0,r.test(n)){var o=Array.from(t.match(u)).map((function(t){return t.replace(":","")})),i=Array.from(n.match(r));i.shift(),L(o,(function(t,n){e[t]=i[n]}))}}return e}function Y(t,n,e){L(I(t),(function(r){g(t[r])&&g(n[r])?Y(t[r],n[r],e):e.break=t[r]!==n[r]}))}var Z=Object.freeze({__proto__:null,route:function(n,r,o){if(e(r)===h&&(o=r,r=undefined),n=F(n),r instanceof W){var i=r.__paths__;-1===i.indexOf(n)&&i.push(n)}return function(e){return new t((function(t){var i=e.subscribe({next:function(e){var r=e.route;if(z(n)){o&&(n=n.toLowerCase(),r=r.toLowerCase());var i=X(n,r),a=I(i).length;(r===n||a>0)&&(a>0&&(e.params=i),t.next(e))}else t.error(new Error("Route string is not a pure route"))},error:t.error,complete:t.complete});return function(){if(r instanceof W){var t=r.__paths__,e=t.indexOf(n);e>-1&&t.splice(e,1)}i.unsubscribe()}}))}},deparam:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){try{e.search=R(e.search,n),e.hashSearch=R(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){if(n instanceof W){var r=n.__paths__;if(r.length>0){var o=e.route,i=!1;L(r,(function(t){if(t===o||I(X(t,o)).length)return!(i=!0)})),i||(e.noMatch=!0,t.next(e))}}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,r=arguments.length>1?arguments[1]:void 0,o={};return e(n)===h&&(r=n,n=s),function(e){return new t((function(t){var i=e.subscribe({next:function(e){L(n,(function(n){if(r&&g(e[n])&&g(o[n])){var i={};if(Y(e[n],o[n],i),i.break)return a(o,e),t.next(e),!1}else if(e[n]!==o[n])return a(o,e),t.next(e),!1}))},error:t.error,complete:t.complete});return function(){i.unsubscribe(),o={}}}))}}});export{W as Router,Z as operators};
