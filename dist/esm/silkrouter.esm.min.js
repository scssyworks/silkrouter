import{Observable as t,fromEvent as n}from"rxjs";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,(o=e.key,i=void 0,"symbol"==typeof(i=function(t,n){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var e=r.call(t,n||"default");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(o,"string"))?i:String(i)),e)}var o,i}function i(t,n,r){return n&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(){return Object.assign.apply(Object,arguments)}var u="popstate",c=/:[^/]+/g,s=/^\/(?=[^?]*)/,f="Route string is not a pure route",h="vpushstate",p=["route","hashRouting","path","hash","search","hashSearch","data"],l="&",b="?",v="",y=void 0,m=r(v),g=r(!0),d=r(y);r({}),r(0);var w=r((function(){})),_="State",x="push".concat(_),S="replace".concat(_);function j(){return("undefined"==typeof globalThis?"undefined":r(globalThis))!==d?globalThis:global||self}function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}var O=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},A=function(t){return"object"==typeof t&&null!==t},R=void 0,k=E(R),N=E(""),P=("undefined"==typeof window?"undefined":E(window))!==k?window.location:null,T=Array.isArray;function C(t){return-1===["__proto__","prototype"].indexOf(t)}function I(t){return/\[/.test(t)}function F(){return Object.create(null)}function z(t,n){var r=this;E(t)!==N&&(t=P?P.search:""),t=t.substring("?"===t.charAt(0));var e=F();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));I(o[0])?U.apply(r,[].concat(o).concat([e,n])):q.apply(r,[o,e,!1,n])})),e}function L(t,n){return E(t)===k?n?[]:F():n?t:(r=t,e=F(),T(r)&&r.forEach((function(t,n){e[n]=t})),e);var r,e}function M(t,n){return A(t)&&!T(t)?{ob:t}:T(t)||E(t)===k?{ob:L(t,O(n))}:{ob:[t],push:null!==t}}function U(t,n,r,e){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var i=o[1],a=o[2];if(I(t=t.replace(/\[([^\[]*)\]/,"")))""===a&&(a="0"),U(t=t.replace(/[^\[]+/,a),n,r[i]=M(r[i],a).ob,e);else if(a){if(C(i)&&C(a)){var u=M(r[i],a),c=u.ob,s=u.push;r[i]=c;var f=s?F():r[i];f[a]=H(n,!e),s&&r[i].push(f)}}else q([o[1],n],r,!0,e)}}function q(t,n,r,e){var o=t[0],i=t[1];C(o)&&(i=H(i,!e),!function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(n,o)?n[o]=r?[i]:i:(n[o]=T(n[o])?n[o]:[n[o]],n[o].push(i)))}function H(t,n){if(null==t)return"";if(n||E(t)!==N)return t;if(t=t.trim(),O(t))return+t;switch(t){case"null":return null;case k:return R;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}var Q=Array.isArray,B=Object.keys;function D(t){return r(t)===m?t.trim():v}function G(t){return s.test(t)}function J(t,n){if(A(t))for(var e=B(t),o=0;o<e.length;o++){var i=e[o],a=n(t[i],O(i)?+i:i);if(r(a)===g&&!a)break}}function K(t,n,e){(t=Array.from(t instanceof Node?[t]:t)).length&&r(n)===m&&J(t,(function(t){var r=new(j().CustomEvent)(n,{bubbles:!0,cancelable:!0,detail:e||[]});t.dispatchEvent(r)}))}var V=i((function t(n,r){e(this,t);var o=n[0],i=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=r||{},this.originalEvent=i||{},this.path=D(c.pathname),this.hash=c.hash,this.search=D(c.search.substring(1)),this.hashSearch=D(c.hash&&c.hash.split(b)[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data}));function W(){var n=this;return function(r){return new t((function(t){var e=r.subscribe({next:function(r){r.detail[2]===n&&t.next(new V(r.detail,r))},error:t.error,complete:t.complete});return function(){e.unsubscribe()}}))}}var X=function(t,n){return D(t?n.hash.substring(1).split(b)[0]:n.pathname)};function Y(t){var r=t.config,e=r.context,o=r.location,i=r.hashRouting;t.popStateSubscription=n(j(),u).subscribe((function(n){var r=X(i,o);r&&K(e,h,[{path:r,hash:i},n,t])})),t.listeners=n(e,h).pipe(W.apply(t)),i&&!o.hash&&t.set("/",!0,!1)}var Z=encodeURIComponent;function $(t,n,e){A(e)?J(e,(function(r,o){$(t,"".concat(n,"[").concat(Q(e)?v:o,"]"),r)})):r(e)!==w&&t.push("".concat(Z(n),"=").concat(Z(e)))}function tt(t){var n=[];return A(t)?(J(t,(function(t,r){$(n,r,t)})),n.join(l)):r(t)===m?t:v}function nt(t,n){var r=this.config.location,e=D(r.search&&r.search.substring(1)),o=D(n?r.hash.split(b)[1]:e);return o?tt(a(z(e),z(o),z(t))):t}function rt(t,n,e){var o=!0;r(e)===g&&(o=e);var i=this.config,u=i.preservePath,c=i.hashRouting,s=i.history,p=a({replace:n,exec:o},r(t)===m?{route:t}:t);n=p.replace,o=p.exec;var l=p.route,d=p.queryString,w=p.preserveQuery,_=p.data,j=p.pageTitle,E=void 0===j?null:j,O=l.split(b);if(A(d)&&(d=tt(d)),d=D(d||O[1]),l=D(O[0]),w&&(d=nt.apply(this,[d,c])),!G(l))throw new TypeError(f);var R=l;return c&&(l="/#".concat(l),u&&(l="".concat(l.substring(1)))),l="".concat(l).concat(d?"".concat(b+d):v),s[n?S:x]({data:_},E,l),o&&R&&K(this.config.context,h,[{path:R,hash:c},y,this]),this}function et(n){var r=this,e=this.config,o=e.hashRouting,i=e.location,a=e.init,u=X(o,i);return function(e){return new t((function(t){var i=e.subscribe(t);return n||(n=!0,a&&u&&t.next(new V([{path:u,hash:o},y,r]))),function(){i.unsubscribe()}}))}}var ot=function(){function t(n){e(this,t);var r=j(),o=r.history,i=r.location,u=r.document;if(!o[x])throw new Error("History unsupported!");this.config=Object.freeze(a({init:!0,hashRouting:!1,preservePath:!1,context:u.body,location:i,history:o},n||{})),this.__paths__=[],Y(this)}return i(t,[{key:"pipe",value:function(){for(var t,n=arguments.length,r=new Array(n),e=0;e<n;e++)r[e]=arguments[e];return(t=this.listeners).pipe.apply(t,[et.apply(this)].concat(r))}},{key:"subscribe",value:function(){var t;return(t=this.pipe()).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return rt.apply(this,n)}},{key:"destroy",value:function(t){r(t)===w&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}]),t}();function it(t,n){var r={};if(c.test(t)){var e=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(c.lastIndex=0,e.test(n)){var o=Array.from(t.match(c)).map((function(t){return t.replace(":",v)})),i=Array.from(n.match(e));i.shift(),J(o,(function(t,n){r[t]=i[n]}))}}return r}function at(t,n,r){J(B(t),(function(e){A(t[e])&&A(n[e])?at(t[e],n[e],r):r.break=t[e]!==n[e]}))}var ut=Object.freeze({__proto__:null,route:function(n,e,o){if(r(e)===g&&(o=e,e=y),n=D(n),e instanceof ot){var i=e.__paths__;-1===i.indexOf(n)&&i.push(n)}return function(r){return new t((function(t){var i=r.subscribe({next:function(r){var e=r.route;if(G(n)){o&&(n=n.toLowerCase(),e=e.toLowerCase());var i=it(n,e),a=B(i).length;(e===n||a>0)&&(a>0&&(r.params=i),t.next(r))}else t.error(new Error(f))},error:t.error,complete:t.complete});return function(){if(e instanceof ot){var t=e.__paths__,r=t.indexOf(n);r>-1&&t.splice(r,1)}i.unsubscribe()}}))}},deparam:function(n){return function(r){return new t((function(t){var e=r.subscribe({next:function(r){try{r.search=z(r.search,n),r.hashSearch=z(r.hashSearch,n),t.next(r)}catch(n){t.error(n)}},error:t.error,complete:t.complete});return function(){e.unsubscribe()}}))}},noMatch:function(n){return function(r){return new t((function(t){var e=r.subscribe({next:function(r){if(n instanceof ot){var e=n.__paths__;if(e.length>0){var o=r.route,i=!1;J(e,(function(t){if(t===o||B(it(t,o)).length)return!(i=!0)})),i||(r.noMatch=!0,t.next(r))}}},error:t.error,complete:t.complete});return function(){e.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,e=arguments.length>1?arguments[1]:void 0,o={};return r(n)===g&&(e=n,n=p),function(r){return new t((function(t){var i=r.subscribe({next:function(r){J(n,(function(n){if(e&&A(r[n])&&A(o[n])){var i={};if(at(r[n],o[n],i),i.break)return a(o,r),t.next(r),!1}else if(r[n]!==o[n])return a(o,r),t.next(r),!1}))},error:t.error,complete:t.complete});return function(){i.unsubscribe(),o={}}}))}}});export{ot as Router,ut as operators};
