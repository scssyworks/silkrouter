import{Observable as t,fromEvent as e}from"rxjs";function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var n,i;var o=s(i?n:(i=1,n=function(t){return"object"==typeof t&&null!==t}));const r=/:[^/]+/g,a=/^\/(?=[^?]*)/,c="vpushstate",h="?",u="",p="State",l=`push${p}`,f=`replace${p}`;function b(t,e,s){t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s||[]}))}function d(t){return function(t){return"string"==typeof t}(t)?t.trim():u}function g(t,e){const s=o(e)?e:{},[n,i]=t.split(h),{replace:r=!1,preventDefault:p=!1,queryString:g=i,data:y,pageTitle:x=null}=s,{preservePath:m,hashRouting:v,history:w,context:R}=this.config;let E=d(n);if(!function(t){return a.test(t)}(E))throw new TypeError("Route format is incorrect!");{const t=E;v&&(E=`${m?"":"/"}#${E}`),E=`${E}${d(g?`${h+g}`:u)}`;const e=w.state||{idx:0};w[r?f:l]({data:y,idx:e.idx+1},x,E),!p&&t&&b(R,c,[{path:t,hash:v},void 0,this])}}const y=(t,e)=>d(t?e.hash.substring(1).split(h)[0]:e.pathname);class x{constructor(t,e){const[s,n,i]=t,{location:o,history:r}=i.config;this.route=s.path,this.isHashRoute=s.hash,this.router=i,this.currentEvent=n||e,this.query={path:d(o.search.substring(1)),hash:d(o.hash.split(h)[1])};const{state:a}=n||{},{data:c,idx:u=0}=a||r.state||{};this.data=c,this.index=+u}}function m(e){let s=e;const{hashRouting:n,location:i,init:o}=this.config,r=y(n,i);return e=>new t((t=>{const i=e.subscribe(t);return s||(s=!0,o&&r&&t.next(new x([{path:r,hash:n},void 0,this]))),()=>{i.unsubscribe()}}))}function v(){return e=>new t((t=>{const s=e.subscribe({next:e=>{const[,,s]=e.detail;s===this&&t.next(new x(e.detail,e))},error:t.error,complete:t.complete});return()=>{s.unsubscribe()}}))}class w{static get global(){return"undefined"!=typeof globalThis?globalThis:global||self}constructor({history:t,context:s,location:n,hash:i}){if(!t[l])throw new Error("History is not supported in this environment!");this.popStateSubscription=e(w.global,"popstate").subscribe((t=>{const e=y(i,n);e&&b(s,c,[{path:e,hash:i},t,this])})),this.listeners=e(s,c).pipe(v.apply(this))}pipe(...t){return this.listeners.pipe(m.apply(this),...t)}subscribe(t){return this.pipe().subscribe(t)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe()}}class R extends w{constructor(t){t=o(t)?t:{};const{history:e,location:s,document:n}=w.global,i=n.body;super({history:e,location:s,context:i,hash:t.hashRouting}),this.config=Object.freeze({init:!0,hashRouting:!1,preservePath:!1,context:i,history:e,location:s,...t}),t.hashRouting&&!s.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){g.apply(this,[t,e])}}function E(t,e){const s={};if(r.test(t)){const n=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(r.lastIndex=0,n.test(e)){const i=Array.from(t.match(r)).map((t=>t.replace(":",u))),o=Array.from(e.match(n));o.shift(),i.forEach(((t,e)=>{s[t]=o[e]}))}}return s}export{R as Router,w as RouterCore,E as resolveParams};
