import{Observable as t,fromEvent as e}from"rxjs";function n(){return Object.assign(...arguments)}const r="popstate",o=/:[^/]+/g,s=/^\/(?=[^?]*)/,i="Route string is not a pure route",c="vpushstate",a=["route","hashRouting","path","hash","search","hashSearch","data"],u="&",h="?",p="",f=void 0,l=typeof p,b="boolean",y=typeof f,g="function",m="State",d=`push${m}`,_=`replace${m}`;function v(){return typeof globalThis!==y?globalThis:global||self}function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}var x=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},S=function(t){return"object"==typeof t&&null!==t},E=void 0,$=w(E),A=w(""),O=("undefined"==typeof window?"undefined":w(window))!==$?window.location:null,R=Array.isArray;function j(t){return-1===["__proto__","prototype"].indexOf(t)}function N(t){return/\[/.test(t)}function C(){return Object.create(null)}function k(t,e){var n=this;w(t)!==A&&(t=O?O.search:""),t=t.substring("?"===t.charAt(0));var r=C();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));N(o[0])?F.apply(n,[].concat(o).concat([r,e])):P.apply(n,[o,r,!1,e])})),r}function I(t,e){return w(t)===$?e?[]:C():e?t:(n=t,r=C(),R(n)&&n.forEach((function(t,e){r[e]=t})),r);var n,r}function T(t,e){return S(t)&&!R(t)?{ob:t}:R(t)||w(t)===$?{ob:I(t,x(e))}:{ob:[t],push:null!==t}}function F(t,e,n,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var s=o[1],i=o[2];if(N(t=t.replace(/\[([^\[]*)\]/,"")))""===i&&(i="0"),F(t=t.replace(/[^\[]+/,i),e,n[s]=T(n[s],i).ob,r);else if(i){if(j(s)&&j(i)){var c=T(n[s],i),a=c.ob,u=c.push;n[s]=a;var h=u?C():n[s];h[i]=z(e,!r),u&&n[s].push(h)}}else P([o[1],e],n,!0,r)}}function P(t,e,n,r){var o=t[0],s=t[1];j(o)&&(s=z(s,!r),!function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(e,o)?e[o]=n?[s]:s:(e[o]=R(e[o])?e[o]:[e[o]],e[o].push(s)))}function z(t,e){if(null==t)return"";if(e||w(t)!==A)return t;if(t=t.trim(),x(t))return+t;switch(t){case"null":return null;case $:return E;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}const L=Array.isArray,M=Object.keys;function U(t){return typeof t===l?t.trim():p}function q(t){return s.test(t)}function H(t,e){if(S(t)){const n=M(t);for(let r=0;r<n.length;r++){const o=n[r],s=e(t[o],x(o)?+o:o);if(typeof s===b&&!s)break}}}function Q(t,e,n){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===l&&H(t,(t=>{const r=new(v().CustomEvent)(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(r)}))}class B{constructor(t,e){const n=t[0],r=t[1],o=t[2],{location:s,history:i}=o.config;this.route=n.path,this.hashRouting=n.hash,this.routerInstance=o,this.virtualEvent=e||{},this.originalEvent=r||{},this.path=U(s.pathname),this.hash=s.hash,this.search=U(s.search.substring(1)),this.hashSearch=U(s.hash&&s.hash.split(h)[1]);const{state:c}=this.originalEvent;this.data=c&&c.data||i.state&&i.state.data}}function D(){return e=>new t((t=>{const n=e.subscribe({next:e=>{e.detail[2]===this&&t.next(new B(e.detail,e))},error:t.error,complete:t.complete});return()=>{n.unsubscribe()}}))}const G=(t,e)=>U(t?e.hash.substring(1).split(h)[0]:e.pathname);function J(t){const{context:n,location:o,hashRouting:s}=t.config;t.popStateSubscription=e(v(),r).subscribe((e=>{const r=G(s,o);r&&Q(n,c,[{path:r,hash:s},e,t])})),t.listeners=e(n,c).pipe(D.apply(t)),s&&!o.hash&&t.set("/",!0,!1)}const K=encodeURIComponent;function V(t,e,n){S(n)?H(n,((r,o)=>{V(t,`${e}[${L(n)?p:o}]`,r)})):typeof n!==g&&t.push(`${K(e)}=${K(n)}`)}function W(t){let e=[];return S(t)?(H(t,((t,n)=>{V(e,n,t)})),e.join(u)):typeof t===l?t:p}function X(t,e){const{location:r}=this.config,o=U(r.search&&r.search.substring(1)),s=U(e?r.hash.split(h)[1]:o);return s?W(n(k(o),k(s),k(t))):t}function Y(t,e,r){let o=!0;typeof r===b&&(o=r);const{preservePath:s,hashRouting:a,history:u}=this.config,y=n({replace:e,exec:o},typeof t===l?{route:t}:t);e=y.replace,o=y.exec;let{route:g,queryString:m}=y;const{preserveQuery:v,data:w,pageTitle:x=null}=y,E=g.split(h);if(S(m)&&(m=W(m)),m=U(m||E[1]),g=U(E[0]),v&&(m=X.apply(this,[m,a])),!q(g))throw new TypeError(i);{const t=g;a&&(g=`/#${g}`,s&&(g=`${g.substring(1)}`)),g=`${g}${m?`${h+m}`:p}`,u[e?_:d]({data:w},x,g),o&&t&&Q(this.config.context,c,[{path:t,hash:a},f,this])}return this}function Z(e){const{hashRouting:n,location:r,init:o}=this.config,s=G(n,r);return r=>new t((t=>{const i=r.subscribe(t);return e||(e=!0,o&&s&&t.next(new B([{path:s,hash:n},f,this]))),()=>{i.unsubscribe()}}))}class tt{constructor(t){const{history:e,location:r,document:o}=v();if(!e[d])throw new Error("History unsupported!");this.config=Object.freeze(n({init:!0,hashRouting:!1,preservePath:!1,context:o.body,location:r,history:e},t||{})),this.__paths__=[],J(this)}pipe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.listeners.pipe(Z.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}set(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Y.apply(this,e)}destroy(t){typeof t===g&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}function et(t,e){const n={};if(o.test(t)){const r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,r.test(e)){const s=Array.from(t.match(o)).map((t=>t.replace(":",p))),i=Array.from(e.match(r));i.shift(),H(s,((t,e)=>{n[t]=i[e]}))}}return n}function nt(t,e,n){H(M(t),(r=>{S(t[r])&&S(e[r])?nt(t[r],e[r],n):n.break=t[r]!==e[r]}))}var rt=Object.freeze({__proto__:null,route:function(e,n,r){if(typeof n===b&&(r=n,n=f),e=U(e),n instanceof tt){const t=n.__paths__;-1===t.indexOf(e)&&t.push(e)}return o=>new t((t=>{const s=o.subscribe({next(n){let o=n.route;if(q(e)){r&&(e=e.toLowerCase(),o=o.toLowerCase());const s=et(e,o),i=M(s).length;(o===e||i>0)&&(i>0&&(n.params=s),t.next(n))}else t.error(new Error(i))},error:t.error,complete:t.complete});return()=>{if(n instanceof tt){const t=n.__paths__,r=t.indexOf(e);r>-1&&t.splice(r,1)}s.unsubscribe()}}))},deparam:function(e){return n=>new t((t=>{const r=n.subscribe({next(n){try{n.search=k(n.search,e),n.hashSearch=k(n.hashSearch,e),t.next(n)}catch(e){t.error(e)}},error:t.error,complete:t.complete});return()=>{r.unsubscribe()}}))},noMatch:function(e){return n=>new t((t=>{const r=n.subscribe({next(n){if(e instanceof tt){const r=e.__paths__;if(r.length>0){const e=n.route;let o=!1;H(r,(t=>{if(t===e||M(et(t,e)).length)return!(o=!0)})),o||(n.noMatch=!0,t.next(n))}}},error:t.error,complete:t.complete});return()=>{r.unsubscribe()}}))},cache:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,r=arguments.length>1?arguments[1]:void 0,o={};return typeof e===b&&(r=e,e=a),s=>new t((t=>{const i=s.subscribe({next(s){H(e,(e=>{if(r&&S(s[e])&&S(o[e])){const r={};if(nt(s[e],o[e],r),r.break)return n(o,s),t.next(s),!1}else if(s[e]!==o[e])return n(o,s),t.next(s),!1}))},error:t.error,complete:t.complete});return()=>{i.unsubscribe(),o={}}}))}});export{tt as Router,rt as operators};
