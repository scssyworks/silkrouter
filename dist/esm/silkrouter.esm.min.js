import{Observable as t,fromEvent as n}from"rxjs";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=/:[^/]+/g,a=/^\/(?=[^?]*)/,u=["route","hashRouting","path","hash","search","hashSearch","data"],c=e(""),s=e(!0),f=e(undefined);e({}),e(0);var h=e((function(){})),p="push".concat("State"),l="replace".concat("State");function b(){return("undefined"==typeof globalThis?"undefined":e(globalThis))!==f?globalThis:global||self}var v=function(t){return"object"==typeof t&&null!==t},y=Array.isArray,m=Object.keys;function d(t){return e(t)===c?t.trim():""}function g(t){return e(t)===c&&a.test(t)}function w(t,n){if(v(t))for(var r=m(t),o=0;o<r.length;o++){var i=r[o],a=n(t[i],("number"==typeof(u=i)?u-u==0:"string"==typeof u&&""!==u.trim()&&(Number.isFinite?Number.isFinite(+u):isFinite(+u)))?+i:i);if(e(a)===s){if(a)continue;break}}var u}var _=b();if(e(_.CustomEvent)===f){var x=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:undefined};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};x.prototype=_.Event.prototype,_.CustomEvent=x}function S(t,n){v(t)&&w(t,(function(t,e){n[e]=t}))}function E(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=v(n[0])?n[0]:{};return w(n,(function(t){S(t,r)})),r}Array.from||(Array.from=function(t){if(y(t))return t;var n=[];return w(t,(function(t){n.push(t)})),n});var A=b();function C(t,n,r){(t=Array.from(t instanceof Node?[t]:t)).length&&e(n)===c&&w(t,(function(t){var e=new A.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(e)}))}var R=function t(n,e){r(this,t);var o=n[0],i=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=e||{},this.originalEvent=i||{},this.path=d(c.pathname),this.hash=c.hash,this.search=d(c.search.substring(1)),this.hashSearch=d(c.hash&&c.hash.split("?")[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data};function j(){var n=this;return function(e){return new t((function(t){var r=e.subscribe({next:function(e){e.detail[2]===n&&t.next(new R(e.detail,e))},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}}function O(){var t=this,e=this.config,r=e.context,o=e.location,i=e.hashRouting;this.popStateSubscription=n(b(),"popstate").subscribe((function(n){var e=d(i?o.hash.substring(1).split("?")[0]:o.pathname);e&&C(r,"vpushstate",[{path:e,hash:i},n,t])})),this.listeners=n(r,"vpushstate").pipe(j.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function k(t,n,r){v(r)?w(r,(function(e,o){k(t,"".concat(n,"[").concat(y(r)?"":o,"]"),e)})):e(r)!==h&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r)))}function N(t){var n=[];return v(t)?(w(t,(function(t,e){k(n,e,t)})),n.join("&")):e(t)===c?t:""}function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}var T=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},I=F(undefined),P=F(""),U=("undefined"==typeof window?"undefined":F(window))!==I?window.location:null,z=Array.isArray;function L(t){return-1===["__proto__","prototype"].indexOf(t)}function M(t){return/\[/.test(t)}function q(){return Object.create(null)}function Q(t,n){var e=this;F(t)!==P&&(t=U?U.search:""),t=t.substring("?"===t.charAt(0));var r=q();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));M(o[0])?G.apply(e,[].concat(o).concat([r,n])):H.apply(e,[o,r,!1,n])})),r}function B(t,n){return F(t)===I?n?[]:q():n?t:(e=t,r=q(),z(e)&&e.forEach((function(t,n){r[n]=t})),r);var e,r}function D(t,n){return"object"!=typeof(e=t)||null===e||z(t)?z(t)||F(t)===I?{ob:B(t,T(n))}:{ob:[t],push:null!==t}:{ob:t};var e}function G(t,n,e,r){var o=t.match(/([^\[]+)\[([^\[]*)\]/)||[];if(3===o.length){var i=o[1],a=o[2];if(M(t=t.replace(/\[([^\[]*)\]/,"")))""===a&&(a="0"),G(t=t.replace(/[^\[]+/,a),n,e[i]=D(e[i],a).ob,r);else if(a){if(L(i)&&L(a)){var u=D(e[i],a),c=u.ob,s=u.push;e[i]=c;var f=s?q():e[i];f[a]=J(n,!r),s&&e[i].push(f)}}else H([o[1],n],e,!0,r)}}function H(t,n,e,r){var o=t[0],i=t[1];L(o)&&(i=J(i,!r),!function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}(n,o)?n[o]=e?[i]:i:(n[o]=z(n[o])?n[o]:[n[o]],n[o].push(i)))}function J(t,n){if(null==t)return"";if(n||F(t)!==P)return t;if(t=t.trim(),T(t))return+t;switch(t){case"null":return null;case I:return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function K(t,n){var e=this.config.location,r=d(e.search&&e.search.substring(1)),o=d(n?e.hash.split("?")[1]:r);return o?N(E(Q(r),Q(o),Q(t))):t}function V(t,n,r){r=r||!0;var o=this.config,i=o.preservePath,a=o.hashRouting,u=o.history,s=E({replace:n,exec:r},e(t)===c?{route:t}:t);n=s.replace,r=s.exec;var f=s.route,h=s.queryString,b=s.preserveQuery,y=s.data,m=s.pageTitle,w=void 0===m?null:m,_=f.split("?");if(v(h)&&(h=N(h)),h=d(h||_[1]),f=d(_[0]),b&&(h=K.apply(this,[h,a])),!g(f))throw new TypeError("Route string is not a pure route");var x=f;return a&&(f="/#".concat(f),i&&(f="".concat(f.substring(1)))),f="".concat(f).concat(h?"".concat("?"+h):""),u[n?l:p]({data:y},w,f),r&&x&&C(this.config.context,"vpushstate",[{path:x,hash:a},undefined,this]),this}function W(n){var e=this,r=this.config,o=r.hashRouting,i=r.location,a=r.init,u=d(o?i.hash.substring(1).split("?")[0]:i.pathname);return function(r){return new t((function(t){var i=r.subscribe(t);return n||(n=!0,a&&u&&t.next(new R([{path:u,hash:o},undefined,e]))),function(){i.unsubscribe()}}))}}var X=function(){function t(n){r(this,t);var e=b(),o=e.history,i=e.location,a=e.document;if(!o[p])throw new Error("Current browser does not support history object");this.config=Object.freeze(E({init:!0,hashRouting:!1,preservePath:!1,context:a.body,location:i,history:o},n||{})),this.__paths__=[],O.apply(this)}var n,i,a;return n=t,i=[{key:"pipe",value:function(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[W.apply(this)].concat(e))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(W.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return V.apply(this,n)}},{key:"destroy",value:function(t){e(t)===h&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}],i&&o(n.prototype,i),a&&o(n,a),t}();function Y(t,n){var e={};if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(i.lastIndex=0,r.test(n)){var o=Array.from(t.match(i)).map((function(t){return t.replace(":","")})),a=Array.from(n.match(r));a.shift(),w(o,(function(t,n){e[t]=a[n]}))}}return e}function Z(t,n,e){w(m(t),(function(r){v(t[r])&&v(n[r])?Z(t[r],n[r],e):e.break=t[r]!==n[r]}))}var $=Object.freeze({__proto__:null,route:function(n,r,o){if(e(r)===s&&(o=r,r=undefined),n=d(n),r instanceof X){var i=r.__paths__;-1===i.indexOf(n)&&i.push(n)}return function(e){return new t((function(t){var i=e.subscribe({next:function(e){var r=e.route;if(g(n)){o&&(n=n.toLowerCase(),r=r.toLowerCase());var i=Y(n,r),a=m(i).length;(r===n||a>0)&&(a>0&&(e.params=i),t.next(e))}else t.error(new Error("Route string is not a pure route"))},error:t.error,complete:t.complete});return function(){if(r instanceof X){var t=r.__paths__,e=t.indexOf(n);e>-1&&t.splice(e,1)}i.unsubscribe()}}))}},deparam:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){try{e.search=Q(e.search,n),e.hashSearch=Q(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){if(n instanceof X){var r=n.__paths__;if(r.length>0){var o=e.route,i=!1;w(r,(function(t){if(t===o||m(Y(t,o)).length)return!(i=!0)})),i||(e.noMatch=!0,t.next(e))}}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,r=arguments.length>1?arguments[1]:void 0,o={};return e(n)===s&&(r=n,n=u),function(e){return new t((function(t){var i=e.subscribe({next:function(e){w(n,(function(n){if(r&&v(e[n])&&v(o[n])){var i={};if(Z(e[n],o[n],i),i.break)return E(o,e),t.next(e),!1}else if(e[n]!==o[n])return E(o,e),t.next(e),!1}))},error:t.error,complete:t.complete});return function(){i.unsubscribe(),o={}}}))}}});export{X as Router,$ as operators};
