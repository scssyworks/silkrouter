import{Observable as t,fromEvent as e}from"rxjs";const s=/:[^/]+/g,n=/^\/(?=[^?]*)/,i="Route string is not a pure route",o="vpushstate",r="?",a="",h=void 0,c=typeof a,u="boolean",p=typeof h,l="State",f=`push${l}`,b=`replace${l}`;var g=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},y=function(t){return"object"==typeof t&&null!==t};const d=Object.keys;function m(t){return typeof t===c?t.trim():a}function x(t,e){if(y(t)){const s=d(t);for(let n=0;n<s.length;n++){const i=s[n],o=e(t[i],g(i)?+i:i);if(typeof o===u&&!o)break}}}function v(t,e){const n={};if(s.test(t)){const i=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,i.test(e)){const o=Array.from(t.match(s)).map((t=>t.replace(":",a))),r=Array.from(e.match(i));r.shift(),x(o,((t,e)=>{n[t]=r[e]}))}}return n}function w(t,e,s){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===c&&x(t,(t=>{const n=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s||[]});t.dispatchEvent(n)}))}function R(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[s,c]=t.split(r),{replace:u=!1,preventDefault:p=!1,queryString:l=c,data:g,pageTitle:y=null}=e,{preservePath:d,hashRouting:x,history:v,context:R}=this.config;if(!function(t){return n.test(t)}(t=m(s)))throw new TypeError(i);{const e=t;x&&(t=`${d?"":"/"}#${t}`),t=`${t}${m(l?`${r+l}`:a)}`;const s=v.state||{idx:0};v[u?b:f]({data:g,idx:s.idx+1},y,t),!p&&e&&w(R,o,[{path:e,hash:x},h,this])}}const _=(t,e)=>m(t?e.hash.substring(1).split(r)[0]:e.pathname);class ${constructor(t,e){const[s,n,i]=t,{location:o,history:a}=i.config;this.route=s.path,this.isHashRoute=s.hash,this.router=i,this.currentEvent=n||e,this.query={path:m(o.search.substring(1)),hash:m(o.hash.split(r)[1])};const{state:h}=n||{},{data:c,idx:u=0}=h||a.state||{};this.data=c,this.index=u}}function E(){return e=>new t((t=>{const s=e.subscribe({next:e=>{e.detail[2]===this&&t.next(new $(e.detail,e))},error:t.error,complete:t.complete});return()=>{s.unsubscribe()}}))}function S(e){const{hashRouting:s,location:n,init:i}=this.config,o=_(s,n);return n=>new t((t=>{const r=n.subscribe(t);return e||(e=!0,i&&o&&t.next(new $([{path:o,hash:s},h,this]))),()=>{r.unsubscribe()}}))}class j{static get global(){return typeof globalThis!==p?globalThis:global||self}constructor(t){let{history:s,context:n,location:i,hash:r}=t;if(!s[f])throw new Error("History unsupported!");this.__paths__=[],this.popStateSubscription=e(j.global,"popstate").subscribe((t=>{const e=_(r,i);e&&w(n,o,[{path:e,hash:r},t,this])})),this.listeners=e(n,o).pipe(E.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.listeners.pipe(S.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}class A extends j{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{history:e,location:s,document:n}=j.global,i=n.body;super({history:e,location:s,context:i,hash:t.hashRouting}),this.config=Object.freeze({init:!0,hashRouting:!1,preservePath:!1,context:i,history:e,location:s,...t}),t.hashRouting&&!s.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){R.apply(this,[t,e])}}export{A as Router,j as RouterCore,v as resolveParams};
