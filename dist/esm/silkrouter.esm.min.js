import{Observable as t,fromEvent as e}from"rxjs";const n=/^\/(?=[^?]*)/,o="Route string is not a pure route",s="vpushstate",i="?",r="",h=void 0,c=typeof r,a="boolean",u=typeof h,p="State",l=`push${p}`,f=`replace${p}`;function b(){return typeof globalThis!==u?globalThis:global||self}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}var d=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},g=function(t){return"object"==typeof t&&null!==t},m=y(void 0);y(""),("undefined"==typeof window?"undefined":y(window))!==m&&window.location;const w=Object.keys;function x(t){return typeof t===c?t.trim():r}function v(t,e,n){(t=Array.from(t instanceof Node?[t]:t)).length&&typeof e===c&&function(t,e){if(g(t)){const n=w(t);for(let o=0;o<n.length;o++){const s=n[o],i=e(t[s],d(s)?+s:s);if(typeof i===a&&!i)break}}}(t,(t=>{const o=new(b().CustomEvent)(e,{bubbles:!0,cancelable:!0,detail:n||[]});t.dispatchEvent(o)}))}function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[c,a]=t.split(i),{replace:u=!1,preventDefault:p=!1,queryString:b=a,data:y,pageTitle:d=null}=e,{preservePath:g,hashRouting:m,history:w,context:S}=this.config;if(!function(t){return n.test(t)}(t=x(c)))throw new TypeError(o);{const e=t;m&&(t=`${g?"":"/"}#${t}`),t=`${t}${x(b?`${i+b}`:r)}`;const n=w.state||{idx:0};w[u?f:l]({data:y,idx:n.idx+1},d,t),!p&&e&&v(S,s,[{path:e,hash:m},h,this])}}const _=(t,e)=>x(t?e.hash.substring(1).split(i)[0]:e.pathname);class R{constructor(t,e){const[n,o,s]=t,{location:r,history:h}=s.config;this.route=n.path,this.isHashRoute=n.hash,this.router=s,this.currentEvent=o||e,this.query={path:x(r.search.substring(1)),hash:x(r.hash.split(i)[1])};const{state:c}=o||{},{data:a,idx:u=0}=c||h.state||{};this.data=a,this.index=u}}function $(){return e=>new t((t=>{const n=e.subscribe({next:e=>{e.detail[2]===this&&t.next(new R(e.detail,e))},error:t.error,complete:t.complete});return()=>{n.unsubscribe()}}))}function j(e){const{hashRouting:n,location:o,init:s}=this.config,i=_(n,o);return o=>new t((t=>{const r=o.subscribe(t);return e||(e=!0,s&&i&&t.next(new R([{path:i,hash:n},h,this]))),()=>{r.unsubscribe()}}))}class E{constructor(t){let{global:n,history:o,context:i,location:r,hash:h}=t;if(!o[l])throw new Error("History unsupported!");this.__paths__=[],this.popStateSubscription=e(n,"popstate").subscribe((t=>{const e=_(h,r);e&&v(i,s,[{path:e,hash:h},t,this])})),this.listeners=e(i,s).pipe($.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.listeners.pipe(j.apply(this),...e)}subscribe(){return this.pipe().subscribe(...arguments)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}class T extends E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=b(),{history:n,location:o,document:s}=e,i=s.body;super({global:e,history:n,location:o,context:i,hash:t.hashRouting}),this.config=Object.freeze(function(){return Object.assign(...arguments)}({init:!0,hashRouting:!1,preservePath:!1},t,{context:i,history:n,location:o})),t.hashRouting&&!o.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){S.apply(this,[t,e])}}export{T as Router,E as RouterCore};
