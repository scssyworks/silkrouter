!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).silkrouter={},t.rxjs)}(this,(function(t,e){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=/:[^/]+/g,a=/^\/(?=[^?]*)/,u=/\[/,c=/([^[]+)\[([^[]*)\]/,s=/\[([^[]*)\]/,f=/[^[]+/,h="Route string is not a pure route",l="vpushstate",p=["route","hashRouting","path","hash","search","hashSearch","data"],b="?",v="",y=void 0,m=n(v),g=n(!0),d=n(y),x=n({});n(0);var w=n((function(){})),_="State",E="push".concat(_),O="replace".concat(_);function S(){return("undefined"==typeof globalThis?"undefined":n(globalThis))!==d?globalThis:global||self}var j=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},C=Array.isArray,R=Object.keys;function A(t){return n(t)===m?t.trim():v}function k(t){return t&&n(t)===x}function T(t){return n(t)===m&&a.test(t)}function N(t,e){if(k(t))for(var r=R(t),o=0;o<r.length;o++){var i=r[o],a=e(t[i],j(i)?+i:i);if(n(a)===g){if(a)continue;break}}}var I=S();if(n(I.CustomEvent)===d){var P=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:y};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n};P.prototype=I.Event.prototype,I.CustomEvent=P}function F(t,e){k(t)&&N(t,(function(t,n){e[n]=t}))}function M(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=k(e[0])?e[0]:{};return N(e,(function(t){F(t,r)})),r}Array.from||(Array.from=function(t){if(C(t))return t;var e=[];return N(t,(function(t){e.push(t)})),e});var U=S();function q(t,e,r){(t=Array.from(t instanceof Node?[t]:t)).length&&n(e)===m&&N(t,(function(t){var n=new U.CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(n)}))}var z=function t(e,n){r(this,t);var o=e[0],i=e[1],a=e[2],u=a.config,c=u.location,s=u.history;this.route=o.path,this.hashRouting=o.hash,this.routerInstance=a,this.virtualEvent=n||{},this.originalEvent=i||{},this.path=A(c.pathname),this.hash=c.hash,this.search=A(c.search.substring(1)),this.hashSearch=A(c.hash&&c.hash.split(b)[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data};function L(){var t=this;return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){n.detail[2]===t&&e.next(new z(n.detail,n))},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}}function Q(){var t=this,n=this.config,r=n.context,o=n.location,i=n.hashRouting;this.popStateSubscription=e.fromEvent(S(),"popstate").subscribe((function(e){var n=A(i?o.hash.substring(1).split(b)[0]:o.pathname);n&&q(r,l,[{path:n,hash:i},e,t])})),this.listeners=e.fromEvent(r,l).pipe(L.apply(this)),i&&!o.hash&&this.set("/",!0,!1)}function B(t,e,r){k(r)?N(r,(function(n,o){B(t,"".concat(e,"[").concat(C(r)?v:o,"]"),n)})):n(r)!==w&&t.push("".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(r)))}function D(t){var e=[];return k(t)?(N(t,(function(t,n){B(e,n,t)})),e.join("&")):n(t)===m?t:v}function G(){return Object.create(null)}function H(t){return u.test(t)}function J(t,e){var n=this;(t=A(t)).charAt(0)===b&&(t=t.replace(b,v));var r=G();return t&&t.split("&").forEach((function(t){var o=t.split("=").map((function(t){return decodeURIComponent(t)}));(H(o[0])?W:X).apply(n,o.concat([r,e,!1]))})),r}function K(t,e){return e?n(t)===d?[]:t:(r=t,o=G(),C(r)&&r.forEach((function(t,e){o[e]=t})),o);var r,o}function V(t,e){return k(r=t)&&!C(r)?{ob:t}:C(t)||n(t)===d?{ob:K(t,j(e))}:{ob:[t],push:null!==t};var r}function W(t,e,n,r){var o=t.match(c)||[];if(3===o.length){var i=o[1],a=o[2];if(H(t=t.replace(s,v)))a===v&&(a="0"),W(t=t.replace(f,a),e,n[i]=V(n[i],a).ob,r);else if(a){var u=V(n[i],a);n[i]=u.ob;var h=r?Y(e):e;u.push?n[i].push(function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},a,h)):n[i][a]=h}else X(i,e,n,r,!0)}}function X(t,e,n,r,o){r&&(e=Y(e)),t in n?(n[t]=C(n[t])?n[t]:[n[t]],n[t].push(e)):n[t]=o?[e]:e}function Y(t){if(null==t)return v;if(n(t)!==m)return t;if(j(t=A(t)))return+t;switch(t){case"null":return null;case d:return y;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function Z(t,e){var n=this.config.location,r=A(n.search&&n.search.substring(1)),o=A(e?n.hash.split(b)[1]:r);return o?D(M(J(r),J(o),J(t))):t}function $(t,e,r){r=r||!0;var o=this.config,i=o.preservePath,a=o.hashRouting,u=o.history,c=M({replace:e,exec:r},n(t)===m?{route:t}:t);e=c.replace,r=c.exec;var s=c.route,f=c.queryString,p=c.preserveQuery,g=c.data,d=c.pageTitle,x=void 0===d?null:d,w=s.split(b);if(k(f)&&(f=D(f)),f=A(f||w[1]),s=A(w[0]),p&&(f=Z.apply(this,[f,a])),!T(s))throw new TypeError(h);var _=s;return a&&(s="/#".concat(s),i&&(s="".concat(s.substring(1)))),s="".concat(s).concat(f?"".concat(b+f):v),u[e?O:E]({data:g},x,s),r&&_&&q(this.config.context,l,[{path:_,hash:a},y,this]),this}function tt(t){var n=this,r=this.config,o=r.hashRouting,i=r.location,a=r.init,u=A(o?i.hash.substring(1).split(b)[0]:i.pathname);return function(r){return new e.Observable((function(e){var i=r.subscribe(e);return t||(t=!0,a&&u&&e.next(new z([{path:u,hash:o},y,n]))),function(){i.unsubscribe()}}))}}var et=function(){function t(e){r(this,t);var n=S(),o=n.history,i=n.location,a=n.document;if(!o[E])throw new Error("Current browser does not support history object");this.config=Object.freeze(M({init:!0,hashRouting:!1,preservePath:!1,context:a.body,location:i,history:o},e||{})),this.__paths__=[],Q.apply(this)}var e,i,a;return e=t,(i=[{key:"pipe",value:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[tt.apply(this)].concat(n))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(tt.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return $.apply(this,e)}},{key:"destroy",value:function(t){n(t)===w&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&o(e.prototype,i),a&&o(e,a),t}();function nt(t,e){var n={};if(i.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(i.lastIndex=0,r.test(e)){var o=Array.from(t.match(i)).map((function(t){return t.replace(":",v)})),a=Array.from(e.match(r));a.shift(),N(o,(function(t,e){n[t]=a[e]}))}}return n}function rt(t,e,n){N(R(t),(function(r){k(t[r])&&k(e[r])?rt(t[r],e[r],n):n.break=t[r]!==e[r]}))}var ot=Object.freeze({__proto__:null,route:function(t,r,o){if(n(r)===g&&(o=r,r=y),t=A(t),r instanceof et){var i=r.__paths__;-1===i.indexOf(t)&&i.push(t)}return function(n){return new e.Observable((function(e){var i=n.subscribe({next:function(n){var r=n.route;if(T(t)){o&&(t=t.toLowerCase(),r=r.toLowerCase());var i=nt(t,r),a=R(i).length;(r===t||a>0)&&(a>0&&(n.params=i),e.next(n))}else e.error(new Error(h))},error:e.error,complete:e.complete});return function(){if(r instanceof et){var e=r.__paths__,n=e.indexOf(t);n>-1&&e.splice(n,1)}i.unsubscribe()}}))}},deparam:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){try{n.search=J(n.search,t),n.hashSearch=J(n.hashSearch,t),e.next(n)}catch(t){e.error(t)}},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}},noMatch:function(t){return function(n){return new e.Observable((function(e){var r=n.subscribe({next:function(n){if(t instanceof et){var r=t.__paths__;if(r.length>0){var o=n.route,i=!1;N(r,(function(t){if(t===o||R(nt(t,o)).length)return!(i=!0)})),i||(n.noMatch=!0,e.next(n))}}},error:e.error,complete:e.complete});return function(){r.unsubscribe()}}))}},cache:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,r=arguments.length>1?arguments[1]:void 0,o={};return n(t)===g&&(r=t,t=p),function(n){return new e.Observable((function(e){var i=n.subscribe({next:function(n){N(t,(function(t){if(r&&k(n[t])&&k(o[t])){var i={};if(rt(n[t],o[t],i),i.break)return M(o,n),e.next(n),!1}else if(n[t]!==o[t])return M(o,n),e.next(n),!1}))},error:e.error,complete:e.complete});return function(){i.unsubscribe(),o={}}}))}}});t.Router=et,t.operators=ot,Object.defineProperty(t,"__esModule",{value:!0})}));
