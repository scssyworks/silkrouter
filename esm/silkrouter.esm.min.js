import{Observable as t,fromEvent as n}from"rxjs";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=/:[^/]+/g,a=/^\/(?=[^?]*)/,u=/\[/,c=/([^[]+)\[([^[]*)\]/,s=/\[([^[]*)\]/,f=/[^[]+/,h=["route","hashRouting","path","hash","search","hashSearch","data"],l=e(""),p=e(!0),b=e(undefined),v=e({});e(0);var y=e((function(){})),m="push".concat("State"),g="replace".concat("State");function d(){return("undefined"==typeof globalThis?"undefined":e(globalThis))!==b?globalThis:global||self}var w=function(t){return"number"==typeof t?t-t==0:"string"==typeof t&&""!==t.trim()&&(Number.isFinite?Number.isFinite(+t):isFinite(+t))},_=Array.isArray,x=Object.keys;function E(t){return e(t)===l?t.trim():""}function S(t){return t&&e(t)===v}function C(t){return e(t)===l&&a.test(t)}function R(t,n){if(S(t))for(var r=x(t),i=0;i<r.length;i++){var o=r[i],a=n(t[o],w(o)?+o:o);if(e(a)===p){if(a)continue;break}}}var A=d();if(e(A.CustomEvent)===b){var j=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:undefined};var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),e};j.prototype=A.Event.prototype,A.CustomEvent=j}function k(t,n){S(t)&&R(t,(function(t,e){n[e]=t}))}function O(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];var r=S(n[0])?n[0]:{};return R(n,(function(t){k(t,r)})),r}Array.from||(Array.from=function(t){if(_(t))return t;var n=[];return R(t,(function(t){n.push(t)})),n});var N=d();function T(t,n,r){(t=Array.from(t instanceof Node?[t]:t)).length&&e(n)===l&&R(t,(function(t){var e=new N.CustomEvent(n,{bubbles:!0,cancelable:!0,detail:r||[]});t.dispatchEvent(e)}))}var I=function t(n,e){r(this,t);var i=n[0],o=n[1],a=n[2],u=a.config,c=u.location,s=u.history;this.route=i.path,this.hashRouting=i.hash,this.routerInstance=a,this.virtualEvent=e||{},this.originalEvent=o||{},this.path=E(c.pathname),this.hash=c.hash,this.search=E(c.search.substring(1)),this.hashSearch=E(c.hash&&c.hash.split("?")[1]);var f=this.originalEvent.state;this.data=f&&f.data||s.state&&s.state.data};function P(){var n=this;return function(e){return new t((function(t){var r=e.subscribe({next:function(e){e.detail[2]===n&&t.next(new I(e.detail,e))},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}}function F(){var t=this,e=this.config,r=e.context,i=e.location,o=e.hashRouting;this.popStateSubscription=n(d(),"popstate").subscribe((function(n){var e=E(o?i.hash.substring(1).split("?")[0]:i.pathname);e&&T(r,"vpushstate",[{path:e,hash:o},n,t])})),this.listeners=n(r,"vpushstate").pipe(P.apply(this)),o&&!i.hash&&this.set("/",!0,!1)}function U(t,n,r){S(r)?R(r,(function(e,i){U(t,"".concat(n,"[").concat(_(r)?"":i,"]"),e)})):e(r)!==y&&t.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(r)))}function z(t){var n=[];return S(t)?(R(t,(function(t,e){U(n,e,t)})),n.join("&")):e(t)===l?t:""}function L(){return Object.create(null)}function M(t){return u.test(t)}function q(t,n){var e=this;"?"===(t=E(t)).charAt(0)&&(t=t.replace("?",""));var r=L();return t&&t.split("&").forEach((function(t){var i=t.split("=").map((function(t){return decodeURIComponent(t)}));(M(i[0])?D:G).apply(e,i.concat([r,n,!1]))})),r}function Q(t,n){return n?e(t)===b?[]:t:(r=t,i=L(),_(r)&&r.forEach((function(t,n){i[n]=t})),i);var r,i}function B(t,n){return S(r=t)&&!_(r)?{ob:t}:_(t)||e(t)===b?{ob:Q(t,w(n))}:{ob:[t],push:null!==t};var r}function D(t,n,e,r){var i=t.match(c)||[];if(3===i.length){var o=i[1],a=i[2];if(M(t=t.replace(s,"")))""===a&&(a="0"),D(t=t.replace(f,a),n,e[o]=B(e[o],a).ob,r);else if(a){var u=B(e[o],a);e[o]=u.ob;var h=r?H(n):n;u.push?e[o].push(function(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}({},a,h)):e[o][a]=h}else G(o,n,e,r,!0)}}function G(t,n,e,r,i){r&&(n=H(n)),t in e?(e[t]=_(e[t])?e[t]:[e[t]],e[t].push(n)):e[t]=i?[n]:n}function H(t){if(null==t)return"";if(e(t)!==l)return t;if(w(t=E(t)))return+t;switch(t){case"null":return null;case b:return;case"true":return!0;case"false":return!1;case"NaN":return NaN;default:return t}}function J(t,n){var e=this.config.location,r=E(e.search&&e.search.substring(1)),i=E(n?e.hash.split("?")[1]:r);return i?z(O(q(r),q(i),q(t))):t}function K(t,n,r){r=r||!0;var i=this.config,o=i.preservePath,a=i.hashRouting,u=i.history,c=O({replace:n,exec:r},e(t)===l?{route:t}:t);n=c.replace,r=c.exec;var s=c.route,f=c.queryString,h=c.preserveQuery,p=c.data,b=c.pageTitle,v=void 0===b?null:b,y=s.split("?");if(S(f)&&(f=z(f)),f=E(f||y[1]),s=E(y[0]),h&&(f=J.apply(this,[f,a])),!C(s))throw new TypeError("Route string is not a pure route");var d=s;return a&&(s="/#".concat(s),o&&(s="".concat(s.substring(1)))),s="".concat(s).concat(f?"".concat("?"+f):""),u[n?g:m]({data:p},v,s),r&&d&&T(this.config.context,"vpushstate",[{path:d,hash:a},undefined,this]),this}function V(n){var e=this,r=this.config,i=r.hashRouting,o=r.location,a=r.init,u=E(i?o.hash.substring(1).split("?")[0]:o.pathname);return function(r){return new t((function(t){var o=r.subscribe(t);return n||(n=!0,a&&u&&t.next(new I([{path:u,hash:i},undefined,e]))),function(){o.unsubscribe()}}))}}var W=function(){function t(n){r(this,t);var e=d(),i=e.history,o=e.location,a=e.document;if(!i[m])throw new Error("Current browser does not support history object");this.config=Object.freeze(O({init:!0,hashRouting:!1,preservePath:!1,context:a.body,location:o,history:i},n||{})),this.__paths__=[],F.apply(this)}var n,o,a;return n=t,(o=[{key:"pipe",value:function(){for(var t,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(t=this.listeners).pipe.apply(t,[V.apply(this)].concat(e))}},{key:"subscribe",value:function(){var t;return(t=this.listeners.pipe(V.apply(this))).subscribe.apply(t,arguments)}},{key:"set",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return K.apply(this,n)}},{key:"destroy",value:function(t){e(t)===y&&t(),this.popStateSubscription.unsubscribe(),this.__paths__.length=0}}])&&i(n.prototype,o),a&&i(n,a),t}();function X(t,n){var e={};if(o.test(t)){var r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(o.lastIndex=0,r.test(n)){var i=Array.from(t.match(o)).map((function(t){return t.replace(":","")})),a=Array.from(n.match(r));a.shift(),R(i,(function(t,n){e[t]=a[n]}))}}return e}function Y(t,n,e){R(x(t),(function(r){S(t[r])&&S(n[r])?Y(t[r],n[r],e):e.break=t[r]!==n[r]}))}var Z=Object.freeze({__proto__:null,route:function(n,r,i){if(e(r)===p&&(i=r,r=undefined),n=E(n),r instanceof W){var o=r.__paths__;-1===o.indexOf(n)&&o.push(n)}return function(e){return new t((function(t){var o=e.subscribe({next:function(e){var r=e.route;if(C(n)){i&&(n=n.toLowerCase(),r=r.toLowerCase());var o=X(n,r),a=x(o).length;(r===n||a>0)&&(a>0&&(e.params=o),t.next(e))}else t.error(new Error("Route string is not a pure route"))},error:t.error,complete:t.complete});return function(){if(r instanceof W){var t=r.__paths__,e=t.indexOf(n);e>-1&&t.splice(e,1)}o.unsubscribe()}}))}},deparam:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){try{e.search=q(e.search,n),e.hashSearch=q(e.hashSearch,n),t.next(e)}catch(n){t.error(n)}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},noMatch:function(n){return function(e){return new t((function(t){var r=e.subscribe({next:function(e){if(n instanceof W){var r=n.__paths__;if(r.length>0){var i=e.route,o=!1;R(r,(function(t){if(t===i||x(X(t,i)).length)return!(o=!0)})),o||(e.noMatch=!0,t.next(e))}}},error:t.error,complete:t.complete});return function(){r.unsubscribe()}}))}},cache:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,r=arguments.length>1?arguments[1]:void 0,i={};return e(n)===p&&(r=n,n=h),function(e){return new t((function(t){var o=e.subscribe({next:function(e){R(n,(function(n){if(r&&S(e[n])&&S(i[n])){var o={};if(Y(e[n],i[n],o),o.break)return O(i,e),t.next(e),!1}else if(e[n]!==i[n])return O(i,e),t.next(e),!1}))},error:t.error,complete:t.complete});return function(){o.unsubscribe(),i={}}}))}}});export{W as Router,Z as operators};
