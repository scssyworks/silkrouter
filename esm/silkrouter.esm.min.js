import{Observable as t,fromEvent as e}from"rxjs";const s=/:[^/]+/g,n=/^\/(?=[^?]*)/,r="vpushstate",i="?",o="",a="State",c=`push${a}`,h=`replace${a}`;function u(t,e){const n={};if(s.test(t)){const r=new RegExp(t.replace(/\//g,"\\/").replace(/:[^/\\]+/g,"([^\\/]+)"));if(s.lastIndex=0,r.test(e)){const i=Array.from(t.match(s)).map((t=>t.replace(":",o))),a=Array.from(e.match(r));a.shift(),i.forEach(((t,e)=>{n[t]=a[e]}))}}return n}function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var l=p((function(t){return"object"==typeof t&&null!==t}));function f(t,e,s){t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:s||[]}))}function b(t){return function(t){return"string"==typeof t}(t)?t.trim():o}function d(t,e){const s=l(e)?e:{},[a,u]=t.split(i),{replace:p=!1,preventDefault:d=!1,queryString:g=u,data:y,pageTitle:x=null}=s,{preservePath:m,hashRouting:v,history:w,context:R}=this.config;let E=b(a);if(!function(t){return n.test(t)}(E))throw new TypeError("Route format is incorrect!");{const t=E;v&&(E=`${m?"":"/"}#${E}`),E=`${E}${b(g?`${i+g}`:o)}`;const e=w.state||{idx:0};w[p?h:c]({data:y,idx:e.idx+1},x,E),!d&&t&&f(R,r,[{path:t,hash:v},void 0,this])}}const g=(t,e)=>b(t?e.hash.substring(1).split(i)[0]:e.pathname);class y{constructor(t,e){const[s,n,r]=t,{location:o,history:a}=r.config;this.route=s.path,this.isHashRoute=s.hash,this.router=r,this.currentEvent=n||e,this.query={path:b(o.search.substring(1)),hash:b(o.hash.split(i)[1])};const{state:c}=n||{},{data:h,idx:u=0}=c||a.state||{};this.data=h,this.index=+u}}function x(e){let s=e;const{hashRouting:n,location:r,init:i}=this.config,o=g(n,r);return e=>new t((t=>{const r=e.subscribe(t);return s||(s=!0,i&&o&&t.next(new y([{path:o,hash:n},void 0,this]))),()=>{r.unsubscribe()}}))}function m(){return e=>new t((t=>{const s=e.subscribe({next:e=>{const[,,s]=e.detail;s===this&&t.next(new y(e.detail,e))},error:t.error,complete:t.complete});return()=>{s.unsubscribe()}}))}class v{static get global(){return"undefined"!=typeof globalThis?globalThis:global||self}constructor(t){let{history:s,context:n,location:i,hash:o}=t;if(!s[c])throw new Error("History is not supported in this environment!");this.popStateSubscription=e(v.global,"popstate").subscribe((t=>{const e=g(o,i);e&&f(n,r,[{path:e,hash:o},t,this])})),this.listeners=e(n,r).pipe(m.apply(this))}pipe(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.listeners.pipe(x.apply(this),...e)}subscribe(t){return this.pipe().subscribe(t)}destroy(t){"function"==typeof t&&t(),this.popStateSubscription.unsubscribe()}}class w extends v{constructor(t){t=l(t)?t:{};const{history:e,location:s,document:n}=v.global,r=n.body;super({history:e,location:s,context:r,hash:t.hashRouting}),this.config=Object.freeze({init:!0,hashRouting:!1,preservePath:!1,context:r,history:e,location:s,...t}),t.hashRouting&&!s.hash&&this.set("/",{replace:!0,preventDefault:!0})}set(t,e){d.apply(this,[t,e])}}export{w as Router,v as RouterCore,u as resolveParams};
